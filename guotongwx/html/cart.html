<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<meta name="renderer" content="webkit"><!-- 国产双核浏览器，启用极速模式 -->
	<meta name="HandheldFriendly" content="true" />
	<meta name="MobileOptimized" content="320" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0" /><!--, minimal-ui  -->
	<!--<meta name="viewport" content="width=device-width, user-scalable=no ,target-densitydpi=device-dpi ,initial-scale= 0.5"/>--><!--IOS对target-densitydpi不支持，所以我们只能设置 initial-scale=0.5 直接让iphone页面缩小一半。-->
	<!--<meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0, maximum-scale=1, user-scalable=no, minimal-ui">--><!--minimal-ui 设置iphone safiri 隐藏工具bar-->
	<!--<meta name="viewport" content="width=640, user-scalable=0"/>-->
	<meta name="description" content="" />
	<meta name="author" content="" />
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black" />
	<meta name="mobile-web-app-status-bar-style" content="black" />
	<meta name="apple-touch-fullscreen" content="yes"/>
	<meta name="touch-fullscreen" content="yes"/>
	<!-- <link rel="apple-touch-icon-precomposed" sizes="114x114" href="Images/apple-touch-icon-114x114-smartone.png" />
	<link rel="apple-touch-icon-precomposed" sizes="72x72" href="Images/apple-touch-icon-72x72-smartone.png" />
	<link rel="apple-touch-icon-precomposed" sizes="57x57" href="Images/apple-touch-icon-57x57-smartone.png" />
	<link rel="shortcut icon" href="Images/apple-touch-icon-smartone.png" />
	<link rel="apple-touch-startup-image" href="Images/startup.png"> --><!--全屏启动时候的启动画面图像, 尺寸320X460 px-->
	<link rel="stylesheet" href="../res/css/base.css?v=2" />
	<link rel="stylesheet" href="../res/css/idangerous.swiper.css?v=2" />
	<link rel="stylesheet" href="../res/css/list.css?v=2" />
	<link rel="stylesheet" href="../res/css/detail.css?v=2" />


	<style type="text/css">
	</style>

	<title>国通购物</title>
	
	<!-- <script id="others_zepto_1-1-6" type="text/javascript" class="library" src="http://zeptojs.com/zepto.min.js"></script> -->
	<script type="text/javascript" src='../res/js/zepto-1.1.6.js?v=22'></script>
	<!-- <script type="text/javascript" src='../res/js/iscroll.js?v=22'></script> -->
	<script type="text/javascript" src='../res/js/idangerous.swiper.js?v=22'></script>

	</head>
	<body>
		
		<div id="Body">
			<div id="Main">
				<!--顶部固定条 begin-->
				<div id="Header">
					<div style="" id="backBt">
						<div class="arrow rotate-90"></div>
					</div>
					<div class="header-title"><span>购物车</span></div>
					<!-- <div class="search-wrapper" style="">
						<div class="search-box">
							<input id="searchInput" type="text" placeholder="中央渔港" />
						</div>
					</div> -->

				</div>
				<!--顶部固定条 end-->
				<div id="Content">
					<!-- 有商品 begin -->
					<div class="cart-top-nav">
						<span class="cl-66">配送至：广东省佛山市</span>
						<span class="cl-red fr" id="cartDeleteGoodsBt">删除商品</span>
					</div>

					<div class="list-box cart-list">
						<!--item 1 begin-->
						<div class="list-item clearfix cart-list-item-11">
							<div id="cartGoodsSelectBt-11" class="cart-list-goods-select-box">
								<span class="checkBox selected">√</span>
							</div>
							<div class="list-img"><img src="../res/images/index/show1.jpg"></div>
							<div class="list-text">
								<a href="detail.html"><span class="list-pro-name">HITOMORROW 三文鱼刺身400g 去皮纯肉 挪威进口海鲜 冰鲜生鱼片</span>
									<div style="" class="personCenterList-item-arrow cartList-item-arrow">
									<div class="arrow rotate90"></div>
									</div>
								</a>
								<div><span class="list-price">￥22.00</span><span class="list-yunfei">运费￥8</span></div>
								<!--数量 begin-->
								<div class="detail-goods-count cart-goods-count">
									<div class="detail-goods-count-title cl-99">数量</div>
									<div class="count-box">
										<button class="count-bt" id="goodsDelCountBt-11"><b>-</b></button><span class="count-line">	</span><input type="number" id="goodsOrderCountInput-11" min="1" pattern="" value="1" class="count-input cl-99"><span class="count-line">	</span><button class="count-bt" id="goodsAddCountBt-11"><b>+</b></button>
									</div>
								</div>
								<!--数量 end-->
								<div class="list-diandian">...</div>
							</div>
						</div>
						<!-- item 1 end -->
						<!-- item 2 begin -->
						<div class="list-item clearfix cart-list-item-22">
							<div id="cartGoodsSelectBt-22" class="cart-list-goods-select-box">
								<span class="checkBox selected">√</span>
							</div>
							<div class="list-img"><img src="../res/images/index/show1.jpg"></div>
							<div class="list-text">
								<a href="detail.html"><span class="list-pro-name">HITOMORROW 三文鱼刺身400g 去皮纯肉 挪威进口海鲜 冰鲜生鱼片</span>
									<div style="" class="personCenterList-item-arrow cartList-item-arrow">
									<div class="arrow rotate90"></div>
									</div>
								</a>
								<div><span class="list-price">￥168.00</span><span class="list-yunfei">运费￥8</span></div>
								<!--数量 begin-->
								<div class="detail-goods-count cart-goods-count">
									<div class="detail-goods-count-title cl-99">数量</div>
									<div class="count-box">
										<button class="count-bt" id="goodsDelCountBt-22"><b>-</b></button><span class="count-line">	</span><input type="number" id="goodsOrderCountInput-22" min="1" pattern="" value="1" class="count-input cl-99"><span class="count-line">	</span><button class="count-bt" id="goodsAddCountBt-22"><b>+</b></button>
									</div>
								</div>
								<!--数量 end-->
								<div class="list-diandian">...</div>
							</div>
						</div>
						<!-- item 2 end -->
					</div>
					<!-- 有商品 end -->
					<!-- 没商品 begin -->
					<div class="cartNoGoodsBox">
						<br/>
						<img src="../res/images/warn-black.png" width="48" height="48" style="vertical-align:middle;" align="absmiddle" />
						<br/><br/>
						<p class="cl-66">您的购物车内没商品！</p>
						<br/><br/>
						<a href="#" class="lookGoodsNowBt">立即逛逛</a>
					</div>
					<!-- 没商品 end -->
					<!-- 总计nav begin -->
					<div class="cartTotalNavBox">
						<div class="cartTotalNavBox-item text-l">
							<div class="allSelectCartGoods">
								<span class="checkBox selected">&radic;</span>
								<span class="cl-66">全选</span>
							</div>
							<div class="totalGoodsWrapper">
								<span class="totalCartPriceWrapper cl-66">
									总计:
								<span class="cl-red" id="totalCartPrice">￥168.00</span></span>
								<br/>
								<span class="totalCartGoodsNumWrapper cl-99">(共<span id="totalCartGoodsNum">2</span>件商品，不含运费)</span>
							</div>
							<a class="bt fr" href="order.html">结算</a>
						</div>
							
					</div>
					<!-- 总计nav end -->
				</div>
				<!--底部固定条 begin-->
				<div id="Footer">
					<div id="menu">
						<div class="menu-item">
							<a href="index.html"><div class="menu-img">
								<img src="../res/images/menu-home.png" alt="home" />
								<!-- <div class="menu-img-box menu-home"></div> -->
							</div>
							<span class="menu-text">首页</span>
							</a>
						</div><div class="menu-item">
							<a href="fenlei.html"><div class="menu-img">
								<img src="../res/images/menu-type.png" alt="type" />
								<!-- <div class="menu-img-box menu-type"></div> -->
							</div>
							<span class="menu-text">分类</span>
							</a>
						</div><div class="menu-item on">
							<a href="cart.html"><div class="menu-img">
								<img src="../res/images/menu-cart-on.png" alt="cart" />
								<!-- <div class="menu-img-box menu-cart"></div> -->
							</div>
							<span class="menu-text">购物车</span>
							</a>
						</div><div class="menu-item">
							<a href="person_center.html"><div class="menu-img">
								<img src="../res/images/menu-person.png" alt="person" />
								<!-- <div class="menu-img-box menu-person"></div> -->
							</div>
							<span class="menu-text">个人中心</span>
							</a>
						</div>
					</div>
				</div>
				<!--底部固定条 end-->
			</div>
		</div>
		
		<!--删除商品 overlay begin-->
		<div class="overlay-mask opacity0"></div>
		<div class="overlay-box" id="cartDeleteGoodsTips">

			<br/>
			<img src="../res/images/warn-white.png" width="48" height="48" style="vertical-align:middle;" align="absmiddle" />
			<br/><br/>
			<p class="cl-ff">是否确认删除已选商品?</p>
			<br/>
			<a href="javascript:void(0);" class="bt" id="cartDeleteGoodsSureBt">确认</a>
			&nbsp;&nbsp;
			<a href="javascript:void(0);" class="bt bt-gray" id="cartDeleteGoodsCloseBt">取消</a>
		</div>
		<!--删除商品 overlay end-->
	</body>
	<script type="text/javascript" src='../res/js/main.js?v=33'></script>

	<script type="text/javascript">

		var goodsMapObj={}
			,goodOrderCountObjAry=[]
		
		;
		//java 输出以下数据
		goodsMapObj={
			'11':{
				price:22.00
				,count:1
				,yunfei:8.00
				,name:'螃蟹'
				,weight:'500g'
				,selected:false
			}
			,'22':{
				price:168.00
				,count:10
				,yunfei:8.00
				,name:'三文鱼刺身400g'
				,weight:'null'
				,selected:true
			}
		};


		//计算总价格
		function calculateTotalPrice(){
			var total=0,goodsNum=0,key;
			//var key;
			for(key in goodsMapObj){
				//console.log(key);
				if(goodsMapObj[key].selected===true){
					goodsNum+=goodsMapObj[key].count;
					total+=goodsMapObj[key].price*goodsMapObj[key].count;
				}
			}
			//show
			console.log(total);
			$('#totalCartPrice').text('￥'+parseFloat(total).toFixed(2));
			$('#totalCartGoodsNum').text(goodsNum);
		}
		//购买数量操作回调
		function goodOrderCountActionCallback(num,id){
			goodsMapObj[id].count=num;//console.log(num);
			////根据goodsMapObj['11']，发送ajax请求后台修改数量
			//...
			calculateTotalPrice();
		}
		//选择商品操作回调
		function cartGoodsSelectCallback(isSelected,id){
			//console.log(isSelected);
			//console.log(id);
			goodsMapObj[id].selected=isSelected;
			calculateTotalPrice();
			if(!!!isSelected){
				allSelectCartGoods.setSelected(false,false);//设置全选状态
			}
		}
		var goodOrderCountObjAry=[];
		var cartGoodsSelectBtAry=[];
		function dataBindInit(){
			var key;
			for(key in goodsMapObj){
				//购买数量操作
				goodOrderCountObjAry.push(
					new goodOrderNumAction({
						delId:'#goodsDelCountBt-'+key
						,addId:'#goodsAddCountBt-'+key
						,numInit:goodsMapObj[key].count
						,showId:'#goodsOrderCountInput-'+key
						,id:key
						,callback:goodOrderCountActionCallback
					})
				);
				//选择商品操作
				cartGoodsSelectBtAry.push(
					new superCheckBox({
						selector:'#cartGoodsSelectBt-'+key
						,id:key
						,selected:!!goodsMapObj[key].selected
						,callback:cartGoodsSelectCallback
					})
				);
			}
		}
		dataBindInit();
		// goodOrderCountObjAry.push(
		// 	new goodOrderNumAction({
		// 		delId:'#goodsDelCountBt-22'
		// 		,addId:'#goodsAddCountBt-22'
		// 		,numInit:10
		// 		,showId:'#goodsOrderCountInput-22'
		// 		,id:'22'
		// 		,callback:goodOrderCountActionCallback
		// 	})
		// );

		
		// cartGoodsSelectBtAry.push(
		// 	new superCheckBox({
		// 		selector:'#cartGoodsSelectBt-22'
		// 		,callback:function(isSelected){
		// 			goodsMapObj['22'].selected=isSelected;
		// 			calculateTotalPrice();
		// 			if(!!!isSelected){
		// 				allSelectCartGoods.setSelected(false,false);
		// 			}
		// 		}
		// 	})
		// );
		//全选
		var allSelectCartGoods = new superCheckBox({
			selector:'.allSelectCartGoods'
			,callback:function(isSelected){//console.log(isSelected);
				var key;
				for(key in goodsMapObj){
					if(!!!isSelected){
						goodsMapObj[key].selected=false;
						$('.cart-list .checkBox').removeClass('selected');
					} else {
						goodsMapObj[key].selected=true;
						$('.cart-list .checkBox').addClass('selected');
					}
				}
				calculateTotalPrice();
			}
		});


		//删除商品功能js
		var overlayDeleteTips=new overlay({
			overlayId:'cartDeleteGoodsTips'
		});
		$('#cartDeleteGoodsBt').on('tap',function(e){
			overlayDeleteTips.show();
		});
		$('#cartDeleteGoodsCloseBt').on('tap',function(e){
			overlayDeleteTips.hide();//取消
		});
		$('#cartDeleteGoodsSureBt').on('tap',function(e){
			//确定删除
			var deleteGoodsId=[],key;
			for(key in goodsMapObj){
				if(!!goodsMapObj[key].selected){
					goodsMapObj[key].selected=false;
					$('.cart-list-item-'+key).remove();
					deleteGoodsId.push(key);
					goodsMapObj[key]=null;
					delete goodsMapObj[key];//销毁数据
				}
			}
			//根据deleteGoodsId，发送ajax请求后台删除
			//...
			overlayDeleteTips.hide();//对话框消失
			calculateTotalPrice();//从新计算总价格
			//allSelectCartGoods.setSelected(false,false);//改变全选按钮状态
		});



	</script>
</html>
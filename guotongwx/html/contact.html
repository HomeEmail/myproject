<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<meta name="renderer" content="webkit"><!-- 国产双核浏览器，启用极速模式 -->
	<meta name="HandheldFriendly" content="true" />
	<meta name="MobileOptimized" content="320" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0" /><!--, minimal-ui  -->
	<!--<meta name="viewport" content="width=device-width, user-scalable=no ,target-densitydpi=device-dpi ,initial-scale= 0.5"/>--><!--IOS对target-densitydpi不支持，所以我们只能设置 initial-scale=0.5 直接让iphone页面缩小一半。-->
	<!--<meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0, maximum-scale=1, user-scalable=no, minimal-ui">--><!--minimal-ui 设置iphone safiri 隐藏工具bar-->
	<!--<meta name="viewport" content="width=640, user-scalable=0"/>-->
	<meta name="description" content="" />
	<meta name="author" content="" />
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black" />
	<meta name="mobile-web-app-status-bar-style" content="black" />
	<meta name="apple-touch-fullscreen" content="yes"/>
	<meta name="touch-fullscreen" content="yes"/>
	<!-- <link rel="apple-touch-icon-precomposed" sizes="114x114" href="Images/apple-touch-icon-114x114-smartone.png" />
	<link rel="apple-touch-icon-precomposed" sizes="72x72" href="Images/apple-touch-icon-72x72-smartone.png" />
	<link rel="apple-touch-icon-precomposed" sizes="57x57" href="Images/apple-touch-icon-57x57-smartone.png" />
	<link rel="shortcut icon" href="Images/apple-touch-icon-smartone.png" />
	<link rel="apple-touch-startup-image" href="Images/startup.png"> --><!--全屏启动时候的启动画面图像, 尺寸320X460 px-->
	<link rel="stylesheet" href="../res/css/base.css?v=2" />
	<link rel="stylesheet" href="../res/css/idangerous.swiper.css?v=2" />
	<link rel="stylesheet" href="../res/css/list.css?v=2" />
	<link rel="stylesheet" href="../res/css/detail.css?v=2" />


	<style type="text/css">
	</style>

	<title>国通购物</title>
	
	<!-- <script id="others_zepto_1-1-6" type="text/javascript" class="library" src="http://zeptojs.com/zepto.min.js"></script> -->
	<script type="text/javascript" src='../res/js/zepto-1.1.6.js?v=22'></script>
	<!-- <script type="text/javascript" src='../res/js/iscroll.js?v=22'></script> -->
	<script type="text/javascript" src='../res/js/idangerous.swiper.js?v=22'></script>

	</head>
	<body>
		
		<div id="Body">
			<div id="Main">
				<!--顶部固定条 begin-->
				<div id="Header">
					<div style="" id="backBt">
						<div class="arrow rotate-90"></div>
					</div>
					<div class="header-title"><span>收货管理设置</span></div>
					<!-- <div class="search-wrapper" style="">
						<div class="search-box">
							<input id="searchInput" type="text" placeholder="中央渔港" />
						</div>
					</div> -->

				</div>
				<!--顶部固定条 end-->
				<div id="Content" class="order-content">
					<div class="contact-list-box">
						<div id="contact-item-11" class="cart-top-nav contact-item selected">
							<div id="" class="contact-list-select-box">
								<span class="radioBox selected">√</span>
							</div>
							<span class="order-contact-text">张三，15622358988<br/>广东省佛山市顺德区红旗路长城小区3号501</span>
							<div class="contact-item-action-bar">
								<span class="bt bt-free bt-gray contact-item-editBt" data-id="11" data-name="张三" data-tel="15622358988" data-proviceId="1" data-proviceName="广东省" data-cityId="1" data-cityName="佛山市" data-countyId="5" data-countyName="顺德区" data-detailAddress="红旗路长城小区3号501" data-zipcode="510000">编辑</span>
								<span class="bt bt-free bt-gray contact-item-deleteBt" data-id="11">删除</span>
								<span class="bt bt-free bt-gray contact-item-setDefaultBt" data-id="11">设为默认</span>
							</div>
							
						</div>
						<div id="contact-item-33" class="cart-top-nav contact-item">
							<div id="" class="contact-list-select-box">
								<span class="radioBox">√</span>
							</div>
							<span class="order-contact-text">张三，15622358988<br/>广东省佛山市顺德区红旗路长城小区3号501</span>
							<div class="contact-item-action-bar">
								<span class="bt bt-free bt-gray contact-item-editBt" data-id="33" data-name="张三" data-tel="15622358988" data-proviceId="1" data-proviceName="广东省" data-cityId="1" data-cityName="佛山市" data-countyId="3" data-countyName="顺德区" data-detailAddress="红旗路长城小区3号501" data-zipcode="510000">编辑</span>
								<span class="bt bt-free bt-gray contact-item-deleteBt" data-id="33">删除</span>
								<span class="bt bt-free bt-gray contact-item-setDefaultBt" data-id="33">设为默认</span>
							</div>
							
						</div>
						<div id="contact-item-22" class="cart-top-nav contact-item">
							<div id="" class="contact-list-select-box">
								<span class="radioBox">√</span>
							</div>
							<span class="order-contact-text">张三，15622358988<br/>广东省佛山市顺德区红旗路长城小区3号501</span>
							<div class="contact-item-action-bar">
								<span class="bt bt-free bt-gray contact-item-editBt" data-id="22" data-name="张三" data-tel="15622358988" data-proviceId="1" data-proviceName="广东省" data-cityId="1" data-cityName="佛山市" data-countyId="2" data-countyName="顺德区" data-detailAddress="红旗路长城小区3号501" data-zipcode="510000">编辑</span>
								<span class="bt bt-free bt-gray contact-item-deleteBt" data-id="22">删除</span>
								<span class="bt bt-free bt-gray contact-item-setDefaultBt" data-id="22">设为默认</span>
							</div>
							
						</div>
						<!-- 添加地址 begin -->
						<div class="text-center">
							<br/><br/>
							<span class="bt addContactBt">+ 添加联系方式</span>
						</div>
						<!-- 添加地址 end -->
					</div>

					<div class="contact-item-edit-box" style="display:none;">
						<h1 class="bgcl-dd" style="padding:10px 10px; font-size:18px;"><b>请完善以下联系信息</b></h1>
						<div class="pd10">
							<h2 class="contact-input-title">收货人姓名：</h2>
							<input type="text" id="contactName" placeholder="姓名" class="contact-input" required="required">
							<h2 class="contact-input-title">收货人电话：</h2>
							<input type="tel" id="contactTel" placeholder="电话" class="contact-input" required="required">
							<h2 class="contact-input-title">收货人地址：</h2>
							<div class="contact-address-selector-box">
								<select id="contactAddressProvinceSelector">
									<option value="1" selected="true">广东省</option>
								</select>
								<select id="contactAddressCitySelector">
									<option value="1" selected="true">佛山市</option>
								</select>
								<select id="contactAddressCountySelector" placeholder="区/县">
									<option value="1" selected="true">顺德区</option>
									<option value="3">禅城区</option>
									<option value="2">南海区</option>
									<option value="4">三水区</option>
									<option value="5">高明区</option>
								</select>
							</div>
							<input type="text" id="contactDetailAddress" placeholder="详细地址" class="contact-input" required="required">
							<h2 class="contact-input-title">邮编：</h2>
							<input type="tel" id="contactZipcode" placeholder="邮编" class="contact-input" required="required">
							<div style="text-align:center;padding:10px 0px;">
								<button class="bt saveContactInfoBt">保存</button>
							</div>
						</div>
					</div>
					
					
				</div>
				<!--底部固定条 begin-->
				
				<!--底部固定条 end-->
			</div>
		</div>
		
	</body>
	<script type="text/javascript" src='../res/js/main.js?v=33'></script>

	<script type="text/javascript">
		var contactId=''//选中的id
			,editingId=''//正在编辑的id
			,editContactBox=$('.contact-item-edit-box')
			,contactListBox=$('.contact-list-box')
			,saveContactInfoBt=$('.saveContactInfoBt')
			,contactName=$('#contactName')
			,contactTel=$('#contactTel')
			,contactZipcode=$('#contactZipcode')
			,contactDetailAddress=$('#contactDetailAddress')
			,contactAddressProvinceSelector=$('#contactAddressProvinceSelector')
			,contactAddressCitySelector=$('#contactAddressCitySelector')
			,contactAddressCountySelector=$('#contactAddressCountySelector')
		;

		location.hash='';//页面载入时清空hash值

		function showEditUiWithHash(){
			location.hash='editContact';
		}
		
		//增加联系方式
		tapOn($('.addContactBt'),function(e){
			editingId='';//新建的联系方式

			contactName.val('');
			contactTel.val('');
			contactAddressProvinceSelector.val(1);
			contactAddressCitySelector.val(1);
			contactAddressCountySelector.val(1);
			contactDetailAddress.val('');
			contactZipcode.val('');
			showEditUiWithHash();
			e.stopPropagation();

			//return false;
		});
		
		//选择地址项
		tapOn($('.contact-list-box'),'.contact-item',function(e){
			//console.log(e);
			//因dom层级问题，停止事件冒泡无法解决，使用e.target来处理
			if($(e.target).hasClass('bt')){
				//事件来自联系项里的按钮，不处理
				return true;//这里不能返回false,会导致之后的事件不能冒泡，监听不能执行,因为代理事件监听器contact-list-box包含了contact-item
			}

			var id=this.id.replace('contact-','')||''
			;
			//alert(id);
			$('.contact-item.selected').removeClass('selected');
			$('.radioBox.selected').removeClass('selected');
			//console.log($(this).find('.radioBox'));
			$(this).find('.radioBox').addClass('selected');
			$(this).addClass('selected');
			contactId=id;
		});
		
		
		//编辑
		tapOn($('.contact-list-box'),'.contact-item-editBt',function(e){
			//console.log(this);
			//e.stopPropagation();//注意dom层级问题
			//console.log(e);
			var el=$(this)
				,id=el.attr('data-id')
				,username=el.attr('data-name')
				,tel=el.attr('data-tel')
				,proviceId=el.attr('data-proviceId')
				,proviceName=el.attr('data-proviceName')
				,cityId=el.attr('data-cityId')
				,cityName=el.attr('data-cityName')
				,countyId=el.attr('data-countyId')
				,countyName=el.attr('data-countyName')
				,detailAddress=el.attr('data-detailAddress')
				,zipcode=el.attr('data-zipcode')
			;
			editingId=id;
			contactName.val(username);
			contactTel.val(tel);
			contactAddressProvinceSelector.val(proviceId);
			contactAddressCitySelector.val(cityId);
			contactAddressCountySelector.val(countyId);
			contactDetailAddress.val(detailAddress);
			contactZipcode.val(zipcode);

			showEditUiWithHash();
			//return false;
		});
		

		// 	//return false;
		// });
		//删除
		tapOn($('.contact-list-box'),'.contact-item-deleteBt',function(e){
			//console.log(this);
			var el=$(this)
				,id=el.attr('data-id')
			;

			if(confirm('确定删除此联系方式？')){
				//ajax执行删除
				if(contactId==id){
					contactId='';
				}
				$('#contact-item-'+id).remove();
				alert('删除成功！');
			}
		});
		
		//设为默认
		tapOn($('.contact-list-box'),'.contact-item-setDefaultBt',function(e){
			//console.log(this);
			//ajax调用
			alert('成功设置默认收货地址');
		}
		);
		
		//验证输入的信息
		function validInputInfo(){
			//alert(contactName.val());alert(contactTel.val());alert(contactDetailAddress.val());
			if(!!!contactName.val() || !!!contactTel.val() || !!!contactDetailAddress.val()){
				return false;
			}
			return true;
		}
		//保存编辑信息
		tapOn(saveContactInfoBt,function(e){
			if(!validInputInfo()){
				alert('输入的信息不完整或有错，请检查！');
				return false;
			}
			//if(!!!editingId){
				//editingId<=0代表新建联系方式
				//ajax请求执行，返回修改的信息
			//}
			//ajax 提交信息，成功后返回列表页并选中刚刚编辑的选项
			goBack();
		});
		//saveContactInfoBt.on('tap',);

		//hashchange事件同时要判断hash，实现界面切换
		$(window).on('hashchange',function(e){
			//console.log(e);
			var url=e.newURL;
			if(url.indexOf('#editContact')>-1){//显示编辑界面
				contactListBox.hide();
				editContactBox.show();
				saveContactInfoBt.focus();
				goTop();//返回顶部
				return false;//避免执行其他监听函数
			}

			//默认界面，显示列表界面//从编辑界面返回
			editContactBox.hide();
			contactListBox.show();

			//修复back时，按两次才back回前一页
			if(location.href+'#'==e.oldURL){//发现旧网址的hash为空再执行一次goBack
				goBack();
			}
		});

	</script>
</html>
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
<title>HiFi音乐-视频专辑</title>
<style>
.smooth { -webkit-transition-duration:300ms; }

.txt{
	 font-size:24px;
	 font-weight:bold;
	 color:#cccccc;
}
.content {
	-webkit-text-overflow: ellipsis;
	display: -webkit-box;
	-webkit-line-clamp: 7;
	-webkit-box-orient: vertical;
}
marquee {
	background: none;
}
</style>
</head>

<body onUnload="release()">
<div id="loadingDiv" class="smooth" style="position:absolute; top:320px; left:600px; width:70px; height:70px; z-index:10; visibility:hidden;">
	<img src="./images/loading.gif" style="position:absolute; top:0px; left:0px;" />
</div>

<div id="pv_window" style="position:absolute; top:0px; left:0px;  width:1280px; height:720px; background:url(images/happyclass/allbg.jpg); display:block; overflow:hidden;">
<!--内容 begin-->
<div style="position:absolute; top:0px; left:0px; width:410px; height:720px; background:url(images/pv_listBg.png); z-index:3;">
	<div style="position:absolute; top:28px; left:145px; width:410px; height:35px; color:#ffffff; font-weight:bold; line-height:35px; font-size:24px;">播放列表</div>
	<div id="List" style="position:absolute; top:92px; left:0px; width:410px; height:545px; overflow:hidden;">
		<div id="list_0" style="position:absolute; top:0px; left:68px; width:335px; height:100px; color:#ffffff;">
			<img id="listImg_0" src="images/tm.gif" width="130" height="100" />
			<div style="position:absolute; top:0px; left:145px; width:180px; height:100px;">
				<table width="100%" height="100%"><tr><td id="listTxt_0" class="txt"></td></tr></table>
			</div>
		</div>
		<div id="list_1" style="position:absolute; top:109px; left:68px; width:335px; height:45px; color:#ffffff;">
			<img id="listImg_1" src="images/tm.gif" width="130" height="100" />
			<div style="position:absolute; top:0px; left:145px; width:180px; height:100px;">
				<table width="100%" height="100%"><tr><td id="listTxt_1" class="txt"></td></tr></table>
			</div>
		</div>
		<div id="list_2" style="position:absolute; top:218px; left:68px; width:335px; height:45px; color:#ffffff;">
			<img id="listImg_2" src="images/tm.gif" width="130" height="100" />
			<div style="position:absolute; top:0px; left:145px; width:180px; height:100px;">
				<table width="100%" height="100%"><tr><td id="listTxt_2" class="txt"></td></tr></table>
			</div>
		</div>
		<div id="list_3" style="position:absolute; top:327px; left:68px; width:335px; height:45px; color:#ffffff;">
			<img id="listImg_3" src="images/tm.gif" width="130" height="100" />
			<div style="position:absolute; top:0px; left:145px; width:180px; height:100px;">
				<table width="100%" height="100%"><tr><td id="listTxt_3" class="txt"></td></tr></table>
			</div>
		</div>
		<div id="list_4" style="position:absolute; top:436px; left:68px; width:335px; height:45px; color:#ffffff;">
			<img id="listImg_4" src="images/tm.gif" width="130" height="100" />
			<div style="position:absolute; top:0px; left:145px; width:180px; height:100px;">
				<table width="100%" height="100%"><tr><td id="listTxt_4" class="txt"></td></tr></table>
			</div>
		</div>
		<div id="list_5" style="position:absolute; top:545px; left:68px; width:335px; height:45px; color:#ffffff;">
			<img id="listImg_5" src="images/tm.gif" width="130" height="100" />
			<div style="position:absolute; top:0px; left:145px; width:180px; height:100px;">
				<table width="100%" height="100%"><tr><td id="listTxt_5" class="txt"></td></tr></table>
			</div>
		</div>
	</div>
	<div id="list_focus" style="position:absolute; top:65px; left:40px; width:370px; height:153px; background:url(images/pv_listFocus.png); z-index:5; opacity:1;"></div>
	
	<div id="top" style="position:absolute; top:70px; left:192px; width:25px; height:12px; background:url(images/last_false.png);"></div>
	<div id="bottom" style="position:absolute; top:640px; left:192px; width:25px; height:12px; background:url(images/next_true.png);"></div>
	<div style="position:absolute; top:660px; left:100px; width:128px; height:20px; background:url(images/tips_2.png);"></div>
	<div style="position:absolute; top:658px; left:215px; width:110px; height:22px; line-height:22px; font-size:24px; color:#ffffff; font-weight:bold; text-align:center;">
		<span id="currPage"></span>/<span id="totalPage"></span>
	</div>
</div>

<div style="position:absolute; top:72px; left:442px; width:782px; height:572px;">
	<div style="position:absolute; top:0px; left:1px; width:781px; height:65px; background:url(images/control_tips.png);"></div>
	<!--<div id="pv_window" style="position:absolute; top:63px; left:0px; width:782px; height:442px;"></div>-->
	<div id="pv_window_status" style="position:absolute; top:210px; left:300px; width:177px; height:175px; background:url(images/pv_play.png); visibility:hidden;"></div>
	<div style="position:absolute; top:500px; left:0px; width:620px; height:80px;">
		<div style="position:absolute; top:4px; left:1px; width:780px; height:70px; background:url(images/pv_progressBg.png);">
			<span style="position:absolute; top:12px; left:10px; width:10px; height:14px; background:url(images/progress_left.png);"></span>
			<span id="index" style="position:absolute; top:12px; left:10px; width:0px; height:14px; background:url(images/progress_index.png) repeat-x;"></span>
			<span id="currIndex" style="position:absolute; top:5px; left:0px; width:30px; height:30px; background:url(images/progress_flag.png);"></span>
		</div>
		<div id="currTime"  style="position:absolute; top:38px; left:10px; width:80px; height:30px; color:#ffffff; font-size:24px; text-align:left;">00:00</div>
		<div id="totalTime" style="position:absolute; top:38px; left:695px; width:80px; height:30px; color:#ffffff; font-size:24px; text-align:center;">00:00</div>
	</div>
</div>	
<!--内容 end-->
</div>

<div id="tips" class="smooth" style="position:absolute; top:0px; left:0px; width:1280px; height:720px; z-index:8; opacity:0; visibility:hidden;"> <!--提示弹出层-->
	<div style="position:absolute; top:0px; left:0px; width:1280px; height:720px; background-color:#000000; opacity:0.3;"></div>
	<div style="position:absolute; top:160px; left:30px; width:1220px; height:360px; border-top:2px #ff3631 solid; border-bottom:1px #ff3631 solid; background-color:#000000;">
		<div id="t_title" style="text-align:center; height:80px; line-height:80px; color:#d82d28; font-size:28px; font-weight:bold; border-bottom:2px #d82d28 solid;"></div>
		<div id="t_content" class="content" style="height:270px; padding-top:80px; line-height:35px; color:#ffffff; text-align:center; font-size:24px; overflow:hidden;"></div>
	</div>
</div>

<div id="pv_fullScreen" class="smooth" style="position:absolute; top:0px; left:0px; width:1280px; height:720px; z-index:6; display:none; visibility:hidden;">
	<div style="position:absolute; top:0px; left:0px; width:1280px; height:65px; background:url(images/pv_fullScreen_top.png);">
		<div id="pv_mediaName" style="position:absolute; top:0px; left:30px; width:675px; height:65px; color:#fff; overflow:hidden; font-weight:bold; line-height:65px; font-size:36px;"></div>
	</div>
	<div id="pv_fullScreen_status" style="position:absolute; top:270px; left:550px; width:177px; height:175px; background:url(images/pv_play.png); visibility:hidden;"></div>
	
	<div style="position:absolute; top:655px; left:0px; width:1280px; height:65px; background:url(images/pv_fullScreen_bottom.png); color:#FFFFFF;">
		<div style="position:absolute; top:12px; left:90px; width:780px; height:70px;">
			<span style="position:absolute; top:12px; left:10px; width:10px; height:14px; background:url(images/progress_left.png);"></span>
			<span id="pv_fullScreen_index" style="position:absolute; top:12px; left:10px; width:0px; height:14px; background:url(images/progress_index.png) repeat-x;"></span>
			<span id="pv_fullScreen_currIndex" style="position:absolute; top:5px; left:0px; width:30px; height:30px; background:url(images/progress_flag.png);"></span>
		</div>
		<div id="pv_fullScreen_currTime"  style="position:absolute; top:0px; left:30px; width:80px; height:60px; line-height:60px; font-size:24px;">00:00</div>
		<div id="pv_fullScreen_totalTime" style="position:absolute; top:0px; left:1190px; width:80px; height:60px; line-height:60px; font-size:24px;">00:00</div>
	</div>
</div>

<div id="tips_order" class="smooth" style="position:absolute; top:0px; left:0px; width:1280px; height:720px; z-index:5; visibility:hidden;">
	<div style="position:absolute; top:0px; left:0px; width:1280px; height:720px; background-color:#000000; opacity:0.4;"></div>
	<div style="position:absolute; top:0px; left:0px; width:1280px; height:720px; background:url(images/order_bg2.png);">
		<div id="tips_orderBtn" style="position:absolute; top:0px; left:0px; width:1280px; height:720px; background:url(images/order2_btn0.png);"></div>
	</div>
</div>

</body>

<script type="text/javascript" src="js/keyEvent.js"></script>
<script type="text/javascript" src="js/lib.js"></script>
<script type="text/javascript" src="js/param.js"></script>
<script type="text/javascript" src="js/listSlip.js"></script>
<script type="text/javascript" src="js/order.js"></script>
<script type="text/javascript" src="js/showTips.js"></script>
<script type="text/javascript" src="js/ajax.js"></script>
<script type="text/javascript">
document.onkeydown = grabEvent;
if(document.onkeypress!==null){
	document.onkeypress = grabEvent;
}
document.onsystemevent = grabEvent;
function grabEvent(_event){
	if(_event.type=='keydown'){
		document.onkeypress = null;
	}
	if(control.play.fullScreenFlag)control.play.hideFullScreenControl();
	var code = Event(_event);
	switch(code){
		case "KEY_UP": //
			if(!order.flag){
				if(!control.play.fullScreenFlag){
					changeListTop(-1);
				}else{
					audio_control.player.previous();
				}
			}
			return 0;
			break;
		case "KEY_DOWN": //
			if(!order.flag){
				if(!control.play.fullScreenFlag){
					changeListTop(1);
				}else{
					audio_control.player.next();
				}
			}
			return 0;
			break;
		case "KEY_LEFT": //
			if(order.flag){
				order.changeFocus(-1);
			}
			return 0;
			break;
		case "KEY_RIGHT": //
			if(order.flag){
				order.changeFocus(1);
			}else if(!control.play.fullScreenFlag){
				control.play.changeFullStatus();
			}
			return 0;
			break;
		case "KEY_PAGE_UP": //
			
			return 0;
			break;		
		case "KEY_PAGE_DOWN": //
			return 0;
			break;
		case "EIS_VOD_RERADY_SUCCESS": //
			audio_control.player.play(0);
			return 0;
			break;
		case "EIS_VOD_PROGRAM_END": //当前流媒体已经播放结束
			audio_control.player.next();
			return 0;
			break;
		case "KEY_NUMBER0":
			control.play.changeFullStatus();
			return 0;
			break;				
		case "KEY_SELECT": //	
			control.clickSelect();
			return 0;
			break;
		case "KEY_EXIT":
		case "KEY_BACK":
			control.clickDoBack();
			return false;
			break;
		default:
			//if(_event.which > 5000 && _event.which < 6000)$("debugShow").innerText += "-d-"+_event.which;
			break;
	}
}

window.onload = init;
var albumId = "";
var backUrl = "";
var payStatus = {
	payState : "",
	payDesc : ""
};

function init(){
	loadingDiv = $('loadingDiv');
	albumId = Q.getDecoded("albumId");
	backUrl = Q.getDecoded("backUrl") != "null" ? Q.getDecoded("backUrl") :  "index.html?menuPos="+ Q.getInt("indexMenuPos",0);
	
	payStatus.payState = Q.getDecoded("payState");
	if(payStatus.payState == "1" || payStatus.payState == 1){
		payStatus.payDesc = "支付成功";
	}else if(payStatus.payState == "0" || payStatus.payState == 0){
		payStatus.payDesc = "支付失败"+ Q.getDecoded("payDesc");
	}	
	control.init();
	//audio_control.player.play();
	//initList();
}

function release(){
	DVB.stopAV(0);
	media.AV.close();
}

var parmObj = {
	DivId:        "list_",           //行DIV的ID名称   
	focusId:      "list_focus",      //焦点的ID
	arrLength:     8, 				//数据总长度
	listSize:      5,               //显示DIV数
	rowHeight:     109,              //每次移动距离
	focusStartPos: 65,              //显示的第一个焦点	X或Y轴（这里是X）坐标
	direction:     "top",          //方向 top 纵向 left 横向
//	cycle:         0,              //0：不循环，1：循环  默认为0
//	pageType:      0,              //翻页形式，0：不翻页 1：翻页  默认为0
//	duration:      "200ms",        //速度，默认为300ms
};

var listObj = null;
function initList(){
	listObj = new listSlip(parmObj);
	listObj.startline = 1; //起始行 从0开始数，默认为0 (注意：pageType=1，不起作用)
	listObj.endline   = 3; //其实列 从0开始数,默认为最后一行(注意：pageType=1，不起作用)
	listObj.firstFlag = true;//按向上的时候是否能滑到 第一行条目的位置 (注意：cycle=1，不起作用)
	listObj.lastFlag = true;//按向下的时候是否能滑到 最后一行条目的位置; (注意：cycle=1，不起作用)
	//焦点位置默认为0，重新赋值或者焦点定位时必须在 文字输出之前
	listObj.listPos = 0; 
	listObj.focusPos = 0;	
	//输出文字
	listObj.haveData = showText;
	listObj.notData = clearText;
	listObj.initInfo();
	//焦点定位处理
	listObj.focusObj.style.webkitTransitionDuration = "0ms";
	listObj.onfocus();
	listObj.focusObj.style.webkitTransitionDuration = listObj.duration;
	changeListTop(0);
	control.play.doSelect();
	//$(parmObj.focusId).style.visibility = 'visible';
}

function showText(_i,_pos){
	//$("listImg_"+_i).src = imgRecordPath + json_album.data.trackList[_pos].trackSmallImg;
	$("listImg_"+_i).src = imgRecordPath + json_album.data.albumSmallImg;
	$("listTxt_"+_i).innerHTML = json_album.data.trackList[_pos].trackName;
}

function clearText(_i){
	$("listImg_"+_i).src = "images/tm.gif";
	$("listTxt_"+_i).innerHTML = "";
}

function listOnfocusStyle(){	
	var tempId = listObj.currId();
	//$("list_"+ tempId).innerHTML = "<marquee>"+ (listObj.listPos + 1) +"."+ json_album.data.trackList[listObj.listPos].trackName +"</marquee>";
}
function listOnblurStyle(){
	var tempId = listObj.currId();
	//$("list_"+ tempId).innerHTML = (listObj.listPos + 1) +"."+ json_album.data.trackList[listObj.listPos].trackName;
}

function changeListTop(_num){
	if((listObj.listPos == 0 && _num < 0) || (listObj.listPos == parmObj.arrLength - 1 && _num > 0))return 0;
	listObj.changeFocus(_num);
	showPage(parseInt(listObj.listPos + 1),parmObj.arrLength);
}

function showPage(_currPage,_totalPage){
	$("currPage").innerHTML = _currPage;
	$("totalPage").innerHTML = _totalPage;
	$("top").style.background = "url(images/"+ (_currPage == 1 ? "last_false" : "last_true") +".png)";
	$("bottom").style.background = "url(images/"+ (_currPage == _totalPage ? "next_false" : "next_true") +".png)";
}

var control = {
	init : function(){
		ajaxGetAlbumData(albumId);
	},
	showInfo : function(){
		//$("album_name").innerText = json_album.data.albumName;
		//$("singer").innerText = json_album.data.artistNames;
	},
	play : {  //播放弹层对象
		fullScreenFlag : false,
		pauseFlag : false,
		fullScreenControlTimer : null,
		playBtnTimer : null,
		show : function(){
			this.doSelect();
		},
		showData : function(){
			var that = this;
			that.pauseFlag = false;
			if(!that.fullScreenFlag){
				$("pv_window_status").style.visibility = "visible";
				$("pv_window_status").style.background = "url(images/pv_play.png)";
				that.playBtnTimer = setTimeout(function(){
					$("pv_window_status").style.visibility = "hidden";
					clearTimeout(that.playBtnTimer);
				},1500);
				audio_control.player.play();
			}else{
				$("pv_fullScreen").style.display = "block";
				$("pv_fullScreen").style.visibility = "visible";
				$("pv_fullScreen").style.opacity = 1;
				$("pv_fullScreen_status").style.visibility = "visible";
				$("pv_fullScreen_status").style.background = "url(images/pv_play.png)";
				that.playBtnTimer = setTimeout(function(){
					$("pv_fullScreen").style.display = "none";
					$("pv_fullScreen").style.visibility = "hidden";
					$("pv_fullScreen").style.opacity = 0;
					clearTimeout(that.fullScreenControlTimer);
				},1500);
				audio_control.player.play();
			}
		},
		changeFullStatus : function(){
			if(!this.fullScreenFlag){
				this.fullScreenFlag = true;
				$("pv_window").style.display = "none";
				$("pv_window").style.visibility = "hidden";
				$("pv_window").style.opacity = 0;
				
				media.video.fullScreen();
				
				$("pv_mediaName").innerText = json_single.data.name;
				this.hideFullScreenControl();
			}else{
				this.fullScreenFlag = false;
				$("pv_fullScreen").style.display = "none";
				$("pv_fullScreen").style.visibility = "hidden";
				$("pv_fullScreen").style.opacity = 0;
				
				media.video.setPosition(442,135,782,442);
				
				$("pv_window").style.display = "block";
				$("pv_window").style.visibility = "visible";
				$("pv_window").style.opacity = 1;
			}
		},
		hideFullScreenControl : function(){
			if(this.fullScreenFlag){
				var that = this;
				$("pv_fullScreen").style.display = "block";
				$("pv_fullScreen").style.visibility = "visible";
				$("pv_fullScreen").style.opacity = 1;
				clearTimeout(this.fullScreenControlTimer);
				this.fullScreenControlTimer = null;
				that.fullScreenControlTimer = setTimeout(function(){
					$("pv_fullScreen_status").style.background = "url(images/" + (that.pauseFlag == false ? "pv_play" : "pv_pause") +".png)";
					if(!that.pauseFlag){
						$("pv_fullScreen").style.display = "none";
						$("pv_fullScreen").style.visibility = "hidden";
						$("pv_fullScreen").style.opacity = 0;
						clearTimeout(that.fullScreenControlTimer);
					}
				},3000);
			}
		},
		doSelect : function(){
			var that = this;
			clearTimeout(that.playBtnTimer);
			that.playBtnTimer = null;
			if(!that.fullScreenFlag){
				if(keyNo != "notFound"){
					if(playPos != listObj.listPos){
						playPos = listObj.listPos;
						ajaxGetSingleData(json_album.data.trackList[playPos].trackId,function(){
							that.pauseFlag = false;
							$("pv_window_status").style.visibility = "visible";
							$("pv_window_status").style.background = "url(images/pv_play.png)";
							that.playBtnTimer = setTimeout(function(){
								$("pv_window_status").style.visibility = "hidden";
								clearTimeout(that.playBtnTimer);
							},1500);
							audio_control.player.play();
						});
					}else{
						if(!that.pauseFlag){
							that.pauseFlag = true;
							$("pv_window_status").style.background = "url(images/pv_pause.png)";
							$("pv_window_status").style.visibility = "visible";
							audio_control.player.pause();
						}else{
							that.pauseFlag = false;
							$("pv_window_status").style.background = "url(images/pv_play.png)";
							that.playBtnTimer = setTimeout(function(){
								$("pv_window_status").style.visibility = "hidden";
								clearTimeout(that.playBtnTimer);
							},1500);
							audio_control.player.play();
						}
					}
				}else{
					showTips.init("tips","t_title|温馨提示","t_content|没有找到用户智能卡!",0);
					showTips.onEventHandle(grabEvent);//事件接管
				}
			}else{
				if(!that.pauseFlag){
					that.pauseFlag = true;
					$("pv_fullScreen_status").style.background = "url(images/pv_pause.png)";
					$("pv_fullScreen_status").style.visibility = "visible";
					audio_control.player.pause();
				}else{
					that.pauseFlag = false;
					$("pv_fullScreen_status").style.background = "url(images/pv_play.png)";
					that.playBtnTimer = setTimeout(function(){
						$("pv_fullScreen_status").style.visibility = "visible";
						clearTimeout(that.playBtnTimer);
					},1500);
					audio_control.player.play();
				}
			}
		}
	},
	clickSelect : function(){
		if(order.flag){
			order.doSelect();
		}else{
			this.play.doSelect();
		}
	},
	clickDoBack : function(){
		if(order.flag){
			order.hide();
		}else{
			if(!this.play.fullScreenFlag){
				location.href = backUrl;
			}else{
				this.play.changeFullStatus();
			}
		}
	}
}

var playPos = -1;
var audioId = "";
var rtsp_url = "";
var audio_control = {
	player : {
		timers : null,
		currTime : 0,
		totalTime : 0,
		index : 0,
		play : function(_model){  //0:歌曲开始播放,1:歌曲暂停后播放
			if(_model == 0)this.currTime = 0;
			if(!control.play.fullScreenFlag){
				media.video.setPosition(442,135,782,442);
			}
			media.AV.play();
			this.startTimer();
		},
		pause : function(){
			media.AV.pause(0);
			this.clearTimer();
		},
		stop : function(){
			media.AV.stop(0);
			this.clearTimer();
			this.currTime = 0;
		},
		previous : function(){ //上一首
			if(playPos == 0){
				showTips.init("tips","t_title|温馨提示","t_content|已经是播放列表第一首",0);
				showTips.onEventHandle(grabEvent);//事件接管
			}else{
				playPos -= 1;
				this.stop();
				ajaxGetSingleData(json_album.data.trackList[playPos].trackId,function(){
					changeListTop(-1);
					control.play.showData();
				});
			}
		},
		next : function(){ //下一首
			if(playPos == json_album.data.trackList.length - 1){
				showTips.init("tips","t_title|温馨提示","t_content|已经是播放列表最后一首",0);
				showTips.onEventHandle(grabEvent);//事件接管
			}else{
				playPos += 1;
				this.stop();
				ajaxGetSingleData(json_album.data.trackList[playPos].trackId,function(){
					changeListTop(1);
					control.play.showData();
				});
			}
		},
		getCurrentPoint : function(){
			//this.currTime = parseInt(media.AV.progress);
			this.currTime++;
			this.totalTime = parseInt(media.AV.duration);
			this.index = parseFloat(this.currTime/this.totalTime);
			this.showProgress(this.index);
			this.showPlayTime();			
			
			if(this.currTime == this.totalTime){
				this.clearTimer();
				this.currTime = 0;
				return 0;
			}
		},
		showProgress : function(_index){
			$("index").style.width = _index*740 +"px";
			$("currIndex").style.left = _index*740 +"px";
			$("pv_fullScreen_index").style.width = _index*1070 +"px";
			$("pv_fullScreen_currIndex").style.left = _index*1070 +"px";	
		},
		showPlayTime : function(){
			$("currTime").innerHTML = isNaN(this.currTime) ? "00:00" : Number(this.currTime).formatTime();
			$("totalTime").innerHTML = isNaN(this.totalTime) ? "00:00" : Number(this.totalTime).formatTime();
			$("pv_fullScreen_currTime").innerHTML = isNaN(this.currTime) ? "00:00" : Number(this.currTime).formatTime();
			$("pv_fullScreen_totalTime").innerHTML = isNaN(this.totalTime) ? "00:00" : Number(this.totalTime).formatTime();
		},
		startTimer : function(){
			if(this.timers == null){
				that = this;
				this.timers = setInterval('that.getCurrentPoint()',1000);
			}	
		},
		clearTimer : function(){
			if(!!this.timers){
				try{
					clearInterval(this.timers);
					this.timers = null;
				}catch(err){
					
				}
			}
		}
	}
}

var order = {  //cscs
	pos : 0,
	flag : false,
	init : function(){
		this.pos = 0;
		this.show();
	},
	show : function(){
		this.flag = true;
		$("tips_order").style.visibility = "visible";
	},
	hide : function(){
		this.flag = false;
		$("tips_order").style.visibility = "hidden";
	},
	changeFocus : function(_num){
		this.pos += _num;
		this.pos = this.pos < 0 ? 0 : this.pos;
		this.pos = this.pos > 1 ? 0 : this.pos;
		$("tips_orderBtn").style.background = "url(images/order2_btn"+ this.pos +".png)";
	},
	doSelect : function(){
		if(this.pos == 0){
			this.optParentLocker();
		}
		this.hide();
	},
	optParentLocker : function(){
		orderFlow.init();//模块初始化

		orderFlow.onEventHandle(grabEvent);//事件接管
		orderFlow.show();//显示模块
		
		orderFlow.successTipsDivCallBack=function(){ 
			json_single.data.userCode = 200;
		};//订购成功关闭弹层回调
		orderFlow.failureTipsDivCallBack=function(){};//订购失败关闭弹层回调
		orderFlow.orderSuccessCallBack=function(){
			json_single.data.userCode = 200;
		};//订购成功回调
		orderFlow.orderFailureCallBack=function(){};//订购失败回调
	
		orderFlow.optParentLocker(function(data){							   
			if(data.code == "200"){
				//有家长锁
				orderFlow.passwordYes = data.passwd;
				orderFlow.showStep('passwordDiv');//去家长锁步骤	
			}else if(data.code == "201"){
				//没有家长锁
				//直接调用开通接口
				orderFlow.checkMyMoney(function(b){
					if(!!b){
						//余额足够
						//直接调用开通接口 
						orderFlow.orderProduct(function(data){
							if(data.code == 200){
								//orderFlow.showStep('successTipsDiv');	
								orderFlow.orderSuccessCallBack();
								//关闭
								orderFlow.close(orderFlow.successTipsDivCallBack);	
							}else if(data.code == 300){
								orderFlow.showStep('myMoneyLess');	
							}else{
								showTips.init("tips","t_title|温馨提示","t_content|系统繁忙,请稍后再试!",0);
								showTips.onEventHandle(orderFlow.preEventFn);//事件接管	
							}
						});
					}else{
						//余额不够,去余额不够页面
						orderFlow.showStep('myMoneyLess');
					}
				});
				return;							
			}else{
				showTips.init("tips","t_title|温馨提示","t_content|系统繁忙,请稍后再试!",0);
				showTips.onEventHandle(orderFlow.preEventFn);//事件接管	
			}
		});
		return 0;
	}
}

Number.prototype.formatTime=function(){
    // 计算
    var h=0,i=0,s=parseInt(this);
    if(s>59){
        i=parseInt(s/60);
        s=parseInt(s%60);
        if(i > 59) {
            h=parseInt(i/60);
            i = parseInt(i%60);
        }
    }
    // 补零
    var zero=function(v){
        return (v>>0)<10?"0"+v:v;
    };
    return [zero(i),zero(s)].join(":");
};

String.prototype.formatSecond = function(){
	var seconde=0,s="";
	s=this.split(":");
	if(s.length == 0){
		seconde = 0;
	}else if(s.length == 1){
		seconde = parseInt(s[0]);	
	}else if(s.length == 2){
		seconde = parseInt(s[0])*60 + parseInt(s[1]);
	}else if(s.length == 3){
		seconde = parseInt(s[0])*3600 + parseInt(s[1])*60 + parseInt(s[2]);	
	}
	return seconde;
}

function play_ajax(_audioId){
	if(req != null){
		req.abort();
		req = null;
		release();
	}
	req = ajax({
		url: iPanel.eventFrame.pre_epg_url +"/defaultHD/en/go_authorization.jsp?playType=1&progId="+ _audioId +"&contentType=0&business=1&baseFlag=0",
		type: "GET", //HTTP 请求类型,GET或POST
		dataType: "html", //请求的文件类型html/xml
		onSuccess: function(html){ //请求成功后执行[可选]
			var json = eval("(" + html + ")");
			rtsp_url = json.playUrl.split("^")[4];
			media.AV.open(rtsp_url,"VOD");
		},
		onComplete:function(){
			req = null;
		},
		onError:function(){ //请求失败后执行[可选]
			showTips.init("tips","t_title|温馨提示","t_content|数据有误!",0);
			showTips.onEventHandle(grabEvent);//事件接管
		},
        post:"",  
        timeout:7000  
	});	
}

var json_album = "";
function ajaxGetAlbumData(_albumId){
	showLoadingDiv();
	if(req != null){
		req.abort();
		req = null;
		hideLoadingDiv();
	}
	req = ajax({
		url: serverUrl +"hifiData/album.action?albumId="+ _albumId +"&keyNo="+ keyNo,
		type: "GET", //HTTP 请求类型,GET或POST
		dataType: "html", //请求的文件类型html/xml
		onSuccess: function(html){ //请求成功后执行[可选]
			hideLoadingDiv();
			json_album = eval("(" + html + ")");
			if(json_album.code == 0){
				parmObj.arrLength = json_album.data.trackList.length;
				collectionId = json_album.data.collectionId;
				initList();
			}
			if(payStatus.payDesc != "" && payStatus.payDesc != "null"){
				showTips.init("tips","t_title|温馨提示","t_content|"+ payStatus.payDesc,0);
				showTips.onEventHandle(grabEvent);//事件接管
			}
		},
		onComplete:function(){
			req = null;
		},
		onError:function(){ //请求失败后执行[可选]
			hideLoadingDiv();
			showTips.init("tips","t_title|温馨提示","t_content|数据有误!",0);
			showTips.onEventHandle(grabEvent);//事件接管
		},
        post:"",  
        timeout:7000  
	});	
}

var json_single;
function ajaxGetSingleData(_singleId,_fn){
	showLoadingDiv();
	if(req != null){
		req = null;
	}
	req = ajax({
		url: serverUrl +"hifiData/single.action?singleId="+ _singleId +"&keyNo="+ keyNo,
		type: "GET", //HTTP 请求类型,GET或POST
		dataType: "html", //请求的文件类型html/xml
		onSuccess: function(html){ //请求成功后执行[可选]
			hideLoadingDiv();
			json_single = eval("(" + html + ")");
			if(json_single.code == "0"){
				if(json_single.data.isfree == 1 || json_single.data.userCode == 200){
					!!_fn&&_fn();
					audioId = json_single.data.vodId;
					play_ajax(audioId);
				}else{
					if(json_single.data.userCode == 202){  //黑名单
						showTips.init("tips","t_title|温馨提示","t_content|您的广电账户已在广电客户黑名单，请拨打 96868 详细咨询!",0);
						showTips.onEventHandle(grabEvent);//事件接管
						return 0;
					}else{ //欠费停用
						order.init();
					}
				}
			}else{
				showTips.init("tips","t_title|温馨提示","t_content|您的广电账户暂时不能使用该服务，请拨打 96868 详细咨询!",0);
				showTips.onEventHandle(grabEvent);//事件接管
				return 0;
			}
		},
		onComplete:function(){
			req = null;
		},
		onError:function(){ //请求失败后执行[可选]
			hideLoadingDiv();
			showTips.init("tips","t_title|温馨提示","t_content|数据有误!",0);
			showTips.onEventHandle(grabEvent);//事件接管
		},
        post:"",  
        timeout:7000  
	});	
}

</script>
</html>

var mainMenu = [
	{
		"name": "精选",
		"type": 0,
		"icon": ["images/mainMenu_0_1.png","images/mainMenu_1_1.png"],
		"subMenu":[
			{"name":"专辑","icon":"images/tm.gif","x":0,"y":0,"w":2,"h":2,"focusImg":"images/focus-454x294.png","type":1,"focusDiv":"content_0_00","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":2,"y":0,"w":1,"h":2,"focusImg":"images/focus-220x294.png","type":2,"focusDiv":"content_0_02","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":3,"y":0,"w":1,"h":2,"focusImg":"images/focus-220x294.png","type":0,"focusDiv":"content_0_03","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":4,"y":0,"w":1,"h":2,"focusImg":"images/focus-220x294.png","type":0,"focusDiv":"content_0_04","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":0,"y":2,"w":1,"h":1,"focusImg":"images/focus-220x140.png","type":0,"focusDiv":"content_0_20","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":1,"y":2,"w":1,"h":1,"focusImg":"images/focus-220x140.png","type":0,"focusDiv":"content_0_21","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":2,"y":2,"w":1,"h":1,"focusImg":"images/focus-220x140.png","type":0,"focusDiv":"content_0_22","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":3,"y":2,"w":1,"h":1,"focusImg":"images/focus-220x140.png","type":0,"focusDiv":"content_0_23","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":4,"y":2,"w":1,"h":1,"focusImg":"images/focus-220x140.png","type":0,"focusDiv":"content_0_24","link":""}
		]
	},
	{
		"name": "Hi-Res",
		"type": 0,
		"icon": ["images/mainMenu_0_2.png","images/mainMenu_1_2.png"],
		"subMenu":[
			{"name":"专辑","icon":"images/tm.gif","x":0,"y":0,"w":2,"h":2,"focusImg":"images/focus-454x294.png","type":1,"focusDiv":"content_1_00","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":2,"y":0,"w":1,"h":2,"focusImg":"images/focus-220x294.png","type":2,"focusDiv":"content_1_02","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":3,"y":0,"w":1,"h":2,"focusImg":"images/focus-220x294.png","type":0,"focusDiv":"content_1_03","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":4,"y":0,"w":1,"h":2,"focusImg":"images/focus-220x294.png","type":0,"focusDiv":"content_1_04","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":0,"y":2,"w":1,"h":1,"focusImg":"images/focus-220x140.png","type":0,"focusDiv":"content_1_20","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":1,"y":2,"w":1,"h":1,"focusImg":"images/focus-220x140.png","type":0,"focusDiv":"content_1_21","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":2,"y":2,"w":1,"h":1,"focusImg":"images/focus-220x140.png","type":0,"focusDiv":"content_1_22","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":3,"y":2,"w":1,"h":1,"focusImg":"images/focus-220x140.png","type":0,"focusDiv":"content_1_23","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":4,"y":2,"w":1,"h":1,"focusImg":"images/focus-220x140.png","type":0,"focusDiv":"content_1_24","link":""}
		]
	},
	{
		"name": "HiFi",
		"type": 0,
		"icon": ["images/mainMenu_0_5.png","images/mainMenu_1_5.png"],
		"subMenu":[
			{"name":"专辑","icon":"images/tm.gif","x":0,"y":0,"w":2,"h":2,"focusImg":"images/focus-454x294.png","type":1,"focusDiv":"content_2_00","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":2,"y":0,"w":1,"h":2,"focusImg":"images/focus-220x294.png","type":2,"focusDiv":"content_2_02","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":3,"y":0,"w":1,"h":2,"focusImg":"images/focus-220x294.png","type":0,"focusDiv":"content_2_03","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":4,"y":0,"w":1,"h":2,"focusImg":"images/focus-220x294.png","type":0,"focusDiv":"content_2_04","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":0,"y":2,"w":1,"h":1,"focusImg":"images/focus-220x140.png","type":0,"focusDiv":"content_2_20","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":1,"y":2,"w":1,"h":1,"focusImg":"images/focus-220x140.png","type":0,"focusDiv":"content_2_21","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":2,"y":2,"w":1,"h":1,"focusImg":"images/focus-220x140.png","type":0,"focusDiv":"content_2_22","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":3,"y":2,"w":1,"h":1,"focusImg":"images/focus-220x140.png","type":0,"focusDiv":"content_2_23","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":4,"y":2,"w":1,"h":1,"focusImg":"images/focus-220x140.png","type":0,"focusDiv":"content_2_24","link":""}
		]
	},
	{
		"name": "流行",
		"type": 0,
		"icon": ["images/mainMenu_0_0.png","images/mainMenu_1_0.png"],
		"subMenu":[
			{"name":"专辑","icon":"images/tm.gif","x":0,"y":0,"w":2,"h":2,"focusImg":"images/focus-454x294.png","type":1,"focusDiv":"content_3_00","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":2,"y":0,"w":1,"h":2,"focusImg":"images/focus-220x294.png","type":2,"focusDiv":"content_3_02","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":3,"y":0,"w":1,"h":2,"focusImg":"images/focus-220x294.png","type":0,"focusDiv":"content_3_03","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":4,"y":0,"w":1,"h":2,"focusImg":"images/focus-220x294.png","type":0,"focusDiv":"content_3_04","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":0,"y":2,"w":1,"h":1,"focusImg":"images/focus-220x140.png","type":0,"focusDiv":"content_3_20","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":1,"y":2,"w":1,"h":1,"focusImg":"images/focus-220x140.png","type":0,"focusDiv":"content_3_21","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":2,"y":2,"w":1,"h":1,"focusImg":"images/focus-220x140.png","type":0,"focusDiv":"content_3_22","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":3,"y":2,"w":1,"h":1,"focusImg":"images/focus-220x140.png","type":0,"focusDiv":"content_3_23","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":4,"y":2,"w":1,"h":1,"focusImg":"images/focus-220x140.png","type":0,"focusDiv":"content_3_24","link":""}
		]
	},
	{
		"name": "轻音乐",
		"type": 0,
		"icon": ["images/mainMenu_0_0.png","images/mainMenu_1_0.png"],
		"subMenu":[
			{"name":"专辑","icon":"images/tm.gif","x":0,"y":0,"w":2,"h":2,"focusImg":"images/focus-454x294.png","type":1,"focusDiv":"content_4_00","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":2,"y":0,"w":1,"h":2,"focusImg":"images/focus-220x294.png","type":2,"focusDiv":"content_4_02","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":3,"y":0,"w":1,"h":2,"focusImg":"images/focus-220x294.png","type":0,"focusDiv":"content_4_03","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":4,"y":0,"w":1,"h":2,"focusImg":"images/focus-220x294.png","type":0,"focusDiv":"content_4_04","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":0,"y":2,"w":1,"h":1,"focusImg":"images/focus-220x140.png","type":0,"focusDiv":"content_4_20","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":1,"y":2,"w":1,"h":1,"focusImg":"images/focus-220x140.png","type":0,"focusDiv":"content_4_21","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":2,"y":2,"w":1,"h":1,"focusImg":"images/focus-220x140.png","type":0,"focusDiv":"content_4_22","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":3,"y":2,"w":1,"h":1,"focusImg":"images/focus-220x140.png","type":0,"focusDiv":"content_4_23","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":4,"y":2,"w":1,"h":1,"focusImg":"images/focus-220x140.png","type":0,"focusDiv":"content_4_24","link":""}
		]
	},
	{
		"name": "古典",
		"type": 0,
		"icon": ["images/mainMenu_0_0.png","images/mainMenu_1_0.png"],
		"subMenu":[
			{"name":"专辑","icon":"images/tm.gif","x":0,"y":0,"w":2,"h":2,"focusImg":"images/focus-454x294.png","type":1,"focusDiv":"content_5_00","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":2,"y":0,"w":1,"h":2,"focusImg":"images/focus-220x294.png","type":2,"focusDiv":"content_5_02","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":3,"y":0,"w":1,"h":2,"focusImg":"images/focus-220x294.png","type":0,"focusDiv":"content_5_03","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":4,"y":0,"w":1,"h":2,"focusImg":"images/focus-220x294.png","type":0,"focusDiv":"content_5_04","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":0,"y":2,"w":1,"h":1,"focusImg":"images/focus-220x140.png","type":0,"focusDiv":"content_5_20","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":1,"y":2,"w":1,"h":1,"focusImg":"images/focus-220x140.png","type":0,"focusDiv":"content_5_21","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":2,"y":2,"w":1,"h":1,"focusImg":"images/focus-220x140.png","type":0,"focusDiv":"content_5_22","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":3,"y":2,"w":1,"h":1,"focusImg":"images/focus-220x140.png","type":0,"focusDiv":"content_5_23","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":4,"y":2,"w":1,"h":1,"focusImg":"images/focus-220x140.png","type":0,"focusDiv":"content_5_24","link":""}
		]
	},
	{
		"name": "爵士",
		"type": 0,
		"icon": ["images/mainMenu_0_0.png","images/mainMenu_1_0.png"],
		"subMenu":[
			{"name":"专辑","icon":"images/tm.gif","x":0,"y":0,"w":2,"h":2,"focusImg":"images/focus-454x294.png","type":1,"focusDiv":"content_6_00","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":2,"y":0,"w":1,"h":2,"focusImg":"images/focus-220x294.png","type":2,"focusDiv":"content_6_02","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":3,"y":0,"w":1,"h":2,"focusImg":"images/focus-220x294.png","type":0,"focusDiv":"content_6_03","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":4,"y":0,"w":1,"h":2,"focusImg":"images/focus-220x294.png","type":0,"focusDiv":"content_6_04","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":0,"y":2,"w":1,"h":1,"focusImg":"images/focus-220x140.png","type":0,"focusDiv":"content_6_20","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":1,"y":2,"w":1,"h":1,"focusImg":"images/focus-220x140.png","type":0,"focusDiv":"content_6_21","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":2,"y":2,"w":1,"h":1,"focusImg":"images/focus-220x140.png","type":0,"focusDiv":"content_6_22","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":3,"y":2,"w":1,"h":1,"focusImg":"images/focus-220x140.png","type":0,"focusDiv":"content_6_23","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":4,"y":2,"w":1,"h":1,"focusImg":"images/focus-220x140.png","type":0,"focusDiv":"content_6_24","link":""}
		]
	}/*,
	{
		"name": "会员中心",
		"type": 0,
		"icon": ["images/mainMenu_0_0.png","images/mainMenu_1_0.png"],
		"subMenu":[
			{"name":"专辑","icon":"images/tm.gif","x":0,"y":0,"w":2,"h":2,"focusImg":"images/focus-454x294.png","type":1,"focusDiv":"content_7_00","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":2,"y":0,"w":1,"h":2,"focusImg":"images/focus-220x294.png","type":2,"focusDiv":"content_7_02","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":3,"y":0,"w":1,"h":2,"focusImg":"images/focus-220x294.png","type":0,"focusDiv":"content_7_03","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":4,"y":0,"w":1,"h":2,"focusImg":"images/focus-220x294.png","type":0,"focusDiv":"content_7_04","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":0,"y":2,"w":1,"h":1,"focusImg":"images/focus-220x140.png","type":0,"focusDiv":"content_7_20","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":1,"y":2,"w":1,"h":1,"focusImg":"images/focus-220x140.png","type":0,"focusDiv":"content_7_21","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":2,"y":2,"w":1,"h":1,"focusImg":"images/focus-220x140.png","type":0,"focusDiv":"content_7_22","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":3,"y":2,"w":1,"h":1,"focusImg":"images/focus-220x140.png","type":0,"focusDiv":"content_7_23","link":""},
			{"name":"专辑","icon":"images/tm.gif","x":4,"y":2,"w":1,"h":1,"focusImg":"images/focus-220x140.png","type":0,"focusDiv":"content_7_24","link":""}
		]
	}*/
];

function showOrder(_url){  //展示订购信息
	orderFlow.init();//模块初始化

	orderFlow.onEventHandle(grabEvent);//事件接管
	

	orderFlow.orderFailureCallBack=function(){};//订购失败回调
	orderFlow.failureTipsDivCallBack=function(){};//订购失败关闭弹层回调

	orderFlow.orderSuccessCallBack=function(){
		jsonUser.status = 0;	
	};//订购成功回调
	orderFlow.successTipsDivCallBack=function(){
		location.href = _url;
		// orderFlow.init();//模块初始化
		// orderFlow.onEventHandle(grabEvent);//事件接管
		// orderFlow.show();//显示模块
		// orderFlow.showStep('successTipsDiv');
	};//订购成功关闭弹层回调

	orderFlow.show();//显示模块
	orderFlow.showStep('orderTipsDiv');//显示哪一步
	// orderFlow.setSuccessTipsDivBt1('参与活动',function(){
	// 	//location.href = "topic/guessSong/index.html";
	// });
}
function release(){
	DVB.stopAV(0);
	media.AV.close();
}
function play_ajax(_audioId){
	ajax({
		url: iPanel.eventFrame.pre_epg_url +"/defaultHD/en/go_authorization.jsp?playType=1&progId="+ _audioId +"&contentType=0&business=1&baseFlag=0",
		type: "GET", //HTTP 请求类型,GET或POST
		dataType: "html", //请求的文件类型html/xml
		onSuccess: function(html){ //请求成功后执行[可选]
			var json = eval("(" + html + ")");
			var rtsp_url = json.playUrl.split("^")[4];
			audio_control.player.open(rtsp_url);
		},
		onComplete:function(){
			
		},
		onError:function(){ //请求失败后执行[可选]
			//showTips.init("tips","t_title|温馨提示","t_content|数据有误!",0);
			//showTips.onEventHandle(grabEvent);//事件接管
		},
        post:"",  
        timeout:20000  
	});	
}
//背景音乐播放控制
var audio_control={
	vodid : [4410326,4410326,4410326] //vod id
	,songName : ['The Boys','The Boys','The Boys'] //歌曲名称
	,player : {
		currTime : 0
		,rtsp_url : '' //播放地址
		,open : function(_rtsp_url){
			this.rtsp_url=_rtsp_url;
			media.AV.open(_rtsp_url,"VOD");
		}
		,play : function(_model){ //0:歌曲开始播放,1:歌曲暂停后播放
			if(_model == 0)this.currTime = 0;
			media.AV.play();
		}
		,stop : function(){
			media.AV.stop(0);
			this.currTime = 0;
		}
		,repeat : function(num){
			media.AV.repeat(num);//num 大于65535 无限循环
		}
	}
	,ajax_bg_song : function(){
		var i=this.fRandomBy(0,2);//三首随机
		var vodid=this.vodid[i];
		var songName=this.songName[i];

		play_ajax(vodid);
		document.getElementById('bgSong').innerHTML='正在播放: '+songName;
	}
	,fRandomBy : function(under, over){ /**生成指定范围的随机整数*/
	    switch(arguments.length){ 
	        case 1: return parseInt(Math.random()*under+1,10); 
	        case 2: return parseInt(Math.random()*(over-under+1) + under,10); 
	        default: return 0; 
	    } 
	} 
};

function eventInit(e){
	if (e.type=='keydown') {
		document.onkeypress=null;
	};
	var code = Event(e);
	switch(code){
		case 'KEY_UP':
			break;
		case "KEY_EXIT":
		case "KEY_BACK":
			window.location.href = iPanel.eventFrame.portal_url;	
			return false;
			break;
		default:
			break;
	}
}
window.onerror=function(a,b,c,d,e,f){
	//alert(a+'||'+b+'||'+c+'||'+d+'||'+e+'||'+f);
};
if(document.onkeypress!==null){
	document.onkeypress = eventInit;
}
document.onkeydown = eventInit;
document.onsystemevent = grabEvent;
function grabEvent(_event){
	if (_event.type=='keydown') {
		document.onkeypress=null;
	};
	var code = Event(_event);
	switch(code){
		case "KEY_UP": //
			contral.clickTop();
			return 0;
			break;
		case "KEY_DOWN": //
			contral.clickDown();
			return 0;
			break;
		case "KEY_LEFT": //
			contral.clickLeft();
			return 0;
			break;
		case "KEY_RIGHT": //
			contral.clickRight();
			return 0;
			break;
		case "KEY_PAGE_UP": //
			
			return false;
			break;		
		case "KEY_PAGE_DOWN": //
			return false;
			break;	
		case "EIS_VOD_RERADY_SUCCESS": //
			//$("debugShow").innerText += "-a-"+_event.which;
			audio_control.player.play(0);
			audio_control.player.repeat(65536);//无限循环
			return 0;
			break;
		case "EIS_VOD_PROGRAM_END"://当前流媒体已经播放结束
			 //单曲循环
			//audio_control.player.stop();
			//release();
			//audio_control.player.open(audio_control.player.rtsp_url);
			return 0;
			break;
		case "KEY_SELECT": //	
			contral.clickSelect();
			return 0;
			break;
		case "KEY_EXIT":
		case "KEY_BACK":
			/*if(jsonUser.status != 0){
				backFlag = true;  //在退出时，点击下次再说时，直接退出的参数
				$("cancelTxt").innerText = "残忍离开";
				actObj.init();
			}else{
				window.location.href = iPanel.eventFrame.portal_url;	
			}*/
			backFlag = true;  //在退出时，点击下次再说时，直接退出的参数
			actObj.init();
			return false;
			break;
		default:
			break;
	}
}
window.onload = init;
var menuPos = 0;
var showActFlag = 1; //0表示上一次进入是系统内，1表示是系统外|系统外进入后弹出活动层
var backFlag = true;
function init(){
	//showActFlag = document.referrer.indexOf("HiFi_cq") > -1 ? 0 : 1; //0表示上一次进入是系统内，1表示是系统外|系统外进入后弹出活动层
	var locacal_url = location.href;
	showActFlag = locacal_url.indexOf("menuPos") > -1 ? 0 : 1; //0表示上一次进入是系统内，1表示是系统外|系统外进入后弹出活动层
	loadingDiv = $('loadingDiv');
	menuPos = Q.getInt("menuPos",0);
	ajaxGetData(function(){
		contral.init();
		if(document.onkeypress!==null){
			document.onkeypress = grabEvent;
		}
		document.onkeydown = grabEvent;
	});
}

var menuBox = null;
function initMenuBox(){
	menuBox = new showList(8, mainMenu.length, menuPos, 40, window);
	menuBox.focusDiv = "menu_focus";
	menuBox.listHigh = 120;
	menuBox.listSign = 1;
	menuBox.focusLoop = false;
	menuBox.haveData = function(List){//List.idPos:对象id,List.dataPos:数据id
		$("menu_" + List.idPos).style.visibility = "visible";
		$("menu_" + List.idPos).innerText = mainMenu[List.dataPos].name;
	};
	menuBox.notData  = function(List){
		$("menu_" + List.idPos).style.visibility = "hidden";
		$("menu_" + List.idPos).innerText = "";
	};
	menuBox.startShow();
}
//listBox.currPage:数据当前页,listBox.listPage:数据总页数


var contral = {
	focusArea : 1,//0:主菜单,1:频道，2:频道内容
	init : function(){
		initMenuBox();
		subMenuObj.init();
		setTimeout(function(){$("menu_focus").style.opacity = 1;},300);
	},
	icon : {
		pos : 0,
		txt : ["播放记录","歌曲搜索","订购"],
		changeFocus : function(_num){
			this.pos += _num;
			if(this.pos < 0){
				this.pos = 0;
			}else if(this.pos > 2){
				this.pos = 2;
			}
			$("icon_focus").style.left = 966 + this.pos*90 +"px";
			$("icon_txt").innerText = this.txt[this.pos];
		},
		focus : function(){
			$("icon_focus").style.opacity = 1;
			$("icon_txt").innerText = this.txt[this.pos];
		},
		blur : function(){
			$("icon_focus").style.opacity = 0;
			$("icon_txt").innerText = "";
		},
		doSelect : function(){
			if(this.pos == 0){
				location.href = "userCenter.html?menuPos="+ this.pos +"&backUrl="+ Q.encode(backUrl);
			}else if(this.pos == 1){
				var backUrl = "index.html?subMenuPos="+ menuBox.position;
				location.href = "recordList.html?backUrl="+ Q.encode(backUrl);
			}else if(this.pos == 2){
				var url = "userCenter/index.html?menu=6";
				subMenuObj.fromUserStatus(url);
			}
		}
	},
	changeMenu : function(_num){
		menuBox.changeList(_num);
		//alert(menuBox.position);
		//subMenuObj.point(menuBox.position);
		
		subMenuObj.init();
	},
	clickTop : function(){
		if(this.focusArea == 0){
			//
		}else if(this.focusArea == 1){
			this.focusArea = 0;
			$("menu_focus").style.opacity = 0.2;
			this.icon.focus();
		}else if(this.focusArea == 2){
			subMenuObj.changeY(-1);
		}
	},
	clickDown : function(){
		if(this.focusArea == 0){
			this.focusArea = 1;
			this.icon.blur();
			$("menu_focus").style.opacity = 1;
		}else if(this.focusArea == 1){
			this.focusArea = 2;
			$("menu_focus").style.opacity = 0.2;
			subMenuObj.focus();
		}else if(this.focusArea == 2){
			subMenuObj.changeY(1);
		}
	},
	clickRight : function(){
		if(this.focusArea == 0){
			this.icon.changeFocus(1);
		}else if(this.focusArea == 1){
			this.changeMenu(1);
		}else if(this.focusArea == 2){
			subMenuObj.changeX(1);
		}
	},
	clickLeft : function(){
		if(this.focusArea == 0){
			this.icon.changeFocus(-1);
		}else if(this.focusArea == 1){
			this.changeMenu(-1);
		}else if(this.focusArea == 2){
			subMenuObj.changeX(-1);
		}
	},
	clickSelect : function(){
		if(this.focusArea == 0){
			this.icon.doSelect();
		}else if(this.focusArea == 1){
			//
		}else if(this.focusArea == 2){
			subMenuObj.onSelect();
		}
	}
}

var subMenuObj = {
	mainPos:0,
	x:0,
	y:0,
	subPos:0,
	visible:false,
	wStep:234,
	hStep:156,
	leftOut : false,
	rightOut : false,
	clear:function(){
		/*for(var i = 0 ; i < 5; i++){
			for(var j = 0; j < 3; j++){
				$("content_"+ this.mainPos +"_" + j + i).style.background = "url(images/tm.gif)";
			}
		}*/
		//for(var i = 0 ; i < mainMenu.length; i++){
			//if(mainMenu[i].subMenu.length > 0){
				//$("content_"+ i).style.display = "none";
				//$("content_"+ i).style.visibility = "hidden";
			//}
		//}
		//$("content_"+ this.mainPos).style.display = "block";
		//$("content_"+ this.mainPos).style.visibility = "visible";
		$("content").innerHTML = "";
		this.x = 0;
		this.y = 0;
		this.subPos = 0;
	},
	initAttr:function(){//焦点初始化
		this.mainPos = mainMenuObj.getPos();
		this.subPos = mainMenuObj.getPos();
		this.updateFocus();
	},
	init:function(){
		subMenuObj.mainPos = menuBox.position;
		//this.initAttr();
		this.clear();
		this.render();
	},
	render:function(){
		if(mainMenu[this.mainPos].subMenu.length == 0)return;
		$("content").innerHTML = 
		'<div class="smooth" style="position:absolute; top:0px; left:0px; width:454px; height:294px; background:url('+ mainMenu[this.mainPos].subMenu[0].icon +');"></div>'
		+'<div class="smooth" style="position:absolute; top:0px; left:468px; width:220px; height:294px; background:url('+ mainMenu[this.mainPos].subMenu[1].icon +');"></div>'
		+'<div class="smooth" style="position:absolute; top:0px; left:702px; width:220px; height:294px; background:url('+ mainMenu[this.mainPos].subMenu[2].icon +');"></div>'
		+'<div class="smooth" style="position:absolute; top:0px; left:936px; width:220px; height:294px; background:url('+ mainMenu[this.mainPos].subMenu[3].icon +');"></div>'
		+'<div class="smooth" style="position:absolute; top:312px; left:0px; width:220px; height:140px; background:url('+ mainMenu[this.mainPos].subMenu[4].icon +');"></div>'
		+'<div class="smooth" style="position:absolute; top:312px; left:234px; width:220px; height:140px; background:url('+ mainMenu[this.mainPos].subMenu[5].icon +');"></div>'
		+'<div class="smooth" style="position:absolute; top:312px; left:468px; width:220px; height:140px; background:url('+ mainMenu[this.mainPos].subMenu[6].icon +');"></div>'
		+'<div class="smooth" style="position:absolute; top:312px; left:702px; width:220px; height:140px; background:url('+ mainMenu[this.mainPos].subMenu[7].icon +');"></div>'
		+'<div class="smooth" style="position:absolute; top:312px; left:936px; width:220px; height:140px; background:url('+ mainMenu[this.mainPos].subMenu[8].icon +');"></div>';
		this.updateFocus();
	},
	setXY:function(){
		var item = mainMenu[this.mainPos].subMenu[this.subPos];
		this.x = item.x;
		this.y = item.y;
	},
	point:function(position){
		this.subPos = position > mainMenu[this.mainPos].subMenu.length - 1 ? 0 : position;
		this.setXY();
		this.updateFocus();
		this.focus();
	},
	focus:function(){
		$("content_focus").style.opacity = 1;
		$("content_focus").style.visibility = 'visible';
		//var item = mainMenu[this.mainPos].subMenu[this.subPos];
		//this.focusContral(item.focusDiv);
	},
	blur:function(){
		$("content_focus").style.opacity = 0;
		$("content_focus").style.visibility = 'hidden';
		//var item = mainMenu[this.mainPos].subMenu[this.subPos];
		//this.blurContral(item.focusDiv);
	},
	isTop:function(){
		return this.y == 0 || ((this.y == 1)&& mainMenu[this.mainPos].subMenu[this.subPos].h == 2);
	},
	isBottom:function(){
		this.getSubPos();
		return this.y == 2 || ((this.y == 1)&& mainMenu[this.mainPos].subMenu[this.subPos].h == 2);
	},
	getSubPos:function(){
		for(var i = 0 ; i < mainMenu[this.mainPos].subMenu.length; i++){
			var item = mainMenu[this.mainPos].subMenu[i];
			if(item.x <= this.x && this.x < (item.x + item.w) && item.y <= this.y && this.y < item.y + item.h){
				this.subPos = i;
				this.x = item.x;
				this.y = item.y; //计算因为形状非宽和高都大于1的时候光标初始化
				return this.subPos;
			}
		}
	},
	changeX:function(_num){
		var pre_obj = mainMenu[this.mainPos].subMenu[this.subPos].focusDiv;
		this.resetX();
		if(_num > 0){
			this.x = this.x + mainMenu[this.mainPos].subMenu[this.subPos].w;
		}else{ 
			this.x--;
		}
		
		if(this.x < 0){
			this.x = 0;
			this.touchLeft();
			return 0;
		}else if(this.x > 4){
			this.x = 4;
			this.touchRight();
			return 0;
		}
		//this.blurContral(pre_obj);
		this.getSubPos();
		this.updateFocus();
		//this.focusContral(mainMenu[this.mainPos].subMenu[this.subPos].focusDiv);
	},
	resetX:function(){
		this.x = mainMenu[this.mainPos].subMenu[this.subPos].x;
	},
	resetY:function(){
		this.y = mainMenu[this.mainPos].subMenu[this.subPos].y;
	},
	touchLeft : function(){
		if(this.leftOut){
			contral.changeMenu(-1);
			this.focus();
		}
	},
	touchRight : function(){
		if(this.rightOut){
			contral.changeMenu(1);
			this.focus();
		}
	},
	updateFocus:function(){
		var item = mainMenu[this.mainPos].subMenu[this.subPos];
		var focusDiv = $("content_focus");
		var width  = (item.w - 1) * this.wStep + 343;
		var height = (item.h - 1) * this.hStep + 253;
		var left   = (item.x - 0) * this.wStep + 1;
		var top    = (item.y - 0) * this.hStep - 60;
		//var focusImg = "url("+item.focusImg +")";
		focusDiv.style.width  = width  + "px";
		focusDiv.style.height = height + "px";
		focusDiv.style.left   = left   + "px";
		focusDiv.style.top    = top    + "px";
		//focusDiv.style.background = focusImg;
	},
	changeY:function(_num){
		//this.blurContral(mainMenu[this.mainPos].subMenu[this.subPos].focusDiv);
		if(_num < 0 && this.isTop()){
			contral.focusArea = 1;
			this.blur();
			$("menu_focus").style.opacity = 1;
			return false;
		}else if(_num > 0 && this.isBottom()){
			//this.blur();
		}else if(_num > 0){
			this.y = this.y + mainMenu[this.mainPos].subMenu[this.subPos].h;
		}else if(_num < 0){
			this.y = this.y - mainMenu[this.mainPos].subMenu[this.subPos].h;
		}
		if(this.y < 0){
			this.y = 0;
		}else if(this.y > 2){
			this.y = 2;
		}
		this.getSubPos();
		this.updateFocus();
		//this.focusContral(mainMenu[this.mainPos].subMenu[this.subPos].focusDiv);
	},
	fromUserStatus : function(_url){  //获取用户信息，做相应跳转
		var backUrl = "index.html?menuPos="+ menuBox.position;
		var url = _url.indexOf('?')>-1 ? _url : _url+'?';
		if(jsonUser == ""){
			showLoadingDiv();
			ajaxGetUser(function(_status){
				if(_status == 1){
					url += "&backUrl="+ Q.encode(backUrl);
					showOrder(url);	
				}else{
					url += "&backUrl="+ Q.encode(backUrl);
					location.href = url;
				}					 
			});
		}else if(jsonUser.status == 1){
			url += "&backUrl="+ Q.encode(backUrl);
			showOrder(url);	
		}else{
			url += "&backUrl="+ Q.encode(backUrl);
			location.href = url;	
		}	
	},
	onSelect:function(){
		var backUrl = "index.html?menuPos="+ menuBox.position;
		var url = mainMenu[menuBox.position].subMenu[this.subPos].link;
		if(url == "erweima"){ //目前二维码区域不做任何处理
			//	
		}else{
			if(menuBox.position == 6){
				this.fromUserStatus(url);	
			}else if(menuBox.position==0&&this.x==0&&this.y==0){
				//精选第一个位置
				this.fromUserStatus(url);
			}else{
				if(this.y == 2 && this.x == 4){
					if(menuBox.position != 0 && menuBox.position != 6){ //定位在更多上
						url += "?menuPos=1&subMenuPos="+ (menuBox.position - 1);
					}	
				}
				url += "&backUrl="+ Q.encode(backUrl);
				location.href = url;
			}
		}
	},
	show:function(){
		if(!this.visible){
			this.visible = true;
			//$("subMenuDiv").style.visibility = "visible";
		}
	},
	hide:function(){
		if(this.visible){
			this.visible = false;
			//$("subMenuDiv").style.visibility = "hidden";
		}
	},
	focusContral : function(_focusObj){
		if(typeof(_focusObj) != "undefined"){
			$(_focusObj).style.webkitTransform = "scale(1.1,1.1)";
			$(_focusObj).style.zIndex = 5;
			//$("content0_focus").style.webkitTransform = "scale(1.1,1.1)";
		}
	},
	blurContral : function(_focusObj){
		if(typeof(_focusObj) != "undefined"){
			$(_focusObj).style.webkitTransform = "scale(1,1)";
			$(_focusObj).style.zIndex = 1;
			//$("content0_focus").style.webkitTransform = "scale(1,1)";
		}
	}
};

function ajaxGetData(fn){
	showLoadingDiv();
	if(req != null){
		req.abort();
		req = null;
		hideLoadingDiv();
	}
	req = ajax({
		url: serverUrl +"hifiHome/homePage.action?urlCode=hifiyinle_2615&random="+(+new Date().getTime()),
		type: "GET", //HTTP 请求类型,GET或POST
		dataType: "html", //请求的文件类型html/xml
		onSuccess: function(html){ //请求成功后执行[可选]
			req = null;
			hideLoadingDiv();
			var json = eval("(" + html + ")");
			formatData(json);
			!!fn&&fn();
			ajaxGetUser();
		},
		onComplete:function(){
			req = null;
		},
		onError:function(){ //请求失败后执行[可选]
			hideLoadingDiv();
			showTips.init("tips","t_title|温馨提示","t_content|系统繁忙,请稍后再试!",0);
			showTips.onEventHandle(grabEvent);//事件接管
		},
        post:"",  
        timeout:120000  
	});	
}

function formatData(_data){
	if(parseInt(_data.code,10)!=0){
		showTips.init("tips","t_title|温馨提示","t_content|系统繁忙,请稍后再试!",0);
		showTips.onEventHandle(grabEvent);//事件接管
		return;
	}
	var datas = _data.data;
	var j=0,jlen=datas.length;
	var k=0,klen=0;
	var len = datas.length;
	for(var i=0;i<len;i++){
		if(!!!mainMenu[i]){
			mainMenu.push({subMenu:[]});
		}
		mainMenu[i].name = datas[i].name;
		k=0;klen = datas[i].tuList.length;

		for(;k<klen;k++){
			if(!!!mainMenu[i].subMenu[k]){
				mainMenu[i].subMenu.push({});
			}
			mainMenu[i].subMenu[k].name = datas[i].tuList[k]['tu'+k].title;
			mainMenu[i].subMenu[k].icon = imgBasePath + datas[i].tuList[k]['tu'+k].img;
			mainMenu[i].subMenu[k].link = datas[i].tuList[k]['tu'+k].href;
		}
	}
}

var jsonUser = "";
function ajaxGetUser(_fn){
	if(req != null){
		req.abort();
		req = null;
	}
	req = ajax({
		url: serverUrl +'hifiUser/getUserInfo.action?keyNo='+ keyNo+'&random='+(+new Date()),
			type: "GET", //HTTP 请求类型,GET或POST
			dataType: "html", //请求的文件类型html/xml
			onSuccess: function(html){ //请求成功后执行[可选]
				hideLoadingDiv();
				jsonUser = eval("(" + html + ")");
				if(jsonUser.status != 0 && showActFlag == 1){ //status--0:已订购，1：未订购，2：欠费，-1：数据异常，-2：BOSS异常
					backFlag = false;  //在退出时，点击下次再说时，直接退出的参数
					actObj.init();	
				}
				!!_fn&&_fn(jsonUser.status);
			},
			onComplete : function(){
				req = null;
				audio_control.ajax_bg_song();//拉取背景音乐
			},
			onError:function(){ //请求失败后执行[可选]
				showTips.init("tips","t_title|温馨提示","t_content|数据有误!",0);
				showTips.onEventHandle(grabEvent);//事件接管
			},
	        post:"",  
	        timeout:7000  
	});	
}

var actObj = {
	pos : 0,
	init : function(){
		this.show();
		this.pos = 1;
		if(backFlag)this.pos = 1;
		//this.pos = 1;
		this.changeFocus();
	},
	show : function(){
		if(contral.focusArea == 0){
			$("icon_focus").style.opacity = 0;	
		}else if(contral.focusArea == 1){
			$("menu_focus").style.opacity = 0;
		}else if(contral.focusArea == 2){
			$("content_focus").style.opacity = 0;	
			$("content_focus").style.visibility = 'hidden';
		}
		if(!backFlag){
			$("actMsg").style.opacity = 1;
			$("actMsg").style.visibility = 'visible';
			
		}else{
			$("actOutMsg").style.opacity = 1;
			$("actOutMsg").style.visibility = 'visible';
			$("actOut_btn0").style.background = "images/61_out_btn1_"+ (this.pos + 1)%2 +".png";
			$("actOut_btn1").style.background = "images/61_out_btn2_"+ this.pos +".png";	
		}
		document.onkeydown = this.keyEvent;
		if(document.onkeypress!==null){
			document.onkeypress = this.keyEvent;
		}
	},
	hide : function(){
		if(!backFlag){
			$("actMsg").style.opacity = 0;	
			$("actMsg").style.visibility = 'hidden';
		}else{
			$("actOutMsg").style.opacity = 0;
			$("actOutMsg").style.visibility = 'hidden';
		}
		document.onkeydown = grabEvent;
		if(document.onkeypress!==null){
			document.onkeypress = grabEvent;
		}
		if(contral.focusArea == 0){
			$("icon_focus").style.opacity = 1;	
		}else if(contral.focusArea == 1){
			$("menu_focus").style.opacity = 1;
		}else if(contral.focusArea == 2){
			$("content_focus").style.opacity = 1;	
			$("content_focus").style.visibility = 'visible';
		}
	},
	changeFocus : function(){
		if(!backFlag){
			this.pos = this.pos == 0 ? 1 : 0;
			$("act_btn0").style.background = "url(images/index-popup-bt1"+ (this.pos==0? "-on" : "") +".png)";
			$("act_btn1").style.background = "url(images/index-back"+ (this.pos==1? "-on" : "") +".png)";
		}else{
			this.pos = this.pos == 0 ? 1 : 0;
			$("actOut_btn0").style.background = "url(images/61_out_btn1_"+ (this.pos + 1)%2 +".png)";
			$("actOut_btn1").style.background = "url(images/61_out_btn2_"+ this.pos +".png)";
		}
	},
	clickSelect : function(_fn){
		if(this.pos == 0){
			if(!backFlag){
				var url = "topic/duoli/index.html";
				location.href = url;
				//this.hide();
				//showOrder_2();
			}else{
				window.location.href = "http://192.168.35.129:4567/CyberCloud_Dispatcher.htm";	
			}
		}else{
			if(!backFlag){
				this.hide();
				!!_fn&&_fn();	
			}else{
				window.location.href = iPanel.eventFrame.portal_url;
			}
		}	
	},
	keyEvent : function(_event){
		if(_event.type=='keydown'){
			document.onkeypress=null;
		}
		var code = Event(_event);
		var that = actObj;
		switch(code){
			case "KEY_UP": //
				that.changeFocus();
				return 0;
				break;
			case "KEY_DOWN": //
				that.changeFocus();
				return 0;
				break;
			case "KEY_LEFT": //
				that.changeFocus();
				return 0;
				break;
			case "KEY_RIGHT": //
				that.changeFocus();
				return 0;
				break;
			case "KEY_SELECT": //	
				that.clickSelect();
				return 0;
				break;
			case "KEY_EXIT":
			case "KEY_BACK":
				that.hide();
				return false;
				break;
			default:
				break;
		}
	}
}

function showOrder_2(){  //活动确定按钮直接订购并跳转活动页
	orderFlow.init();//模块初始化

	orderFlow.onEventHandle(grabEvent);//事件接管
	
	orderFlow.successTipsDivCallBack=function(){ 
		
	};//订购成功关闭弹层回调
	orderFlow.failureTipsDivCallBack=function(){};//订购失败关闭弹层回调
	orderFlow.orderSuccessCallBack=function(){
		var url = "topic/duoli/index.html";
		location.href = url;
	};//订购成功回调
	orderFlow.orderFailureCallBack=function(){};//订购失败回调

	orderFlow.show();//显示模块
	orderFlow.optParentLocker(function(data){	   
		if(data.status==0){
			if(data.result.code == 200){	
				//有家长锁
				orderFlow.passwordYes = data.result.lockerPass;
				orderFlow.showStep('passwordDiv');//去家长锁步骤
			}else if(data.result.code == 201){
				//没有家长锁
				//直接调用开通接口
				orderFlow.checkMyMoney(function(b){
					if(!!b){
						//余额足够
						//直接调用开通接口 
						orderFlow.orderProduct(function(data){
							if(data.status == 0){
								//orderFlow.showStep('successTipsDiv');	
								orderFlow.orderSuccessCallBack();
								//关闭
								orderFlow.close(orderFlow.successTipsDivCallBack);	
							}else if(data.status == 1){
								orderFlow.showStep('repeatTipsDiv');
							}else{
								orderFlow.showStep('failureTipsDiv');	
							}														
						});
					}else{
						//余额不够,去余额不够页面
						orderFlow.showStep('myMoneyLess');
					}
				});
				return;
			}
		}else{
			showTips.init("tips","t_title|温馨提示","t_content|数据有误!",0);
			showTips.onEventHandle(grabEvent);//事件接管
		}
	});
	return 0;
}
//{"name":"专辑","icon":"images/tm.gif","x":0,"y":0,"w":2,"h":2,"focusImg":"images/focus-454x294.png","type":1,"focusDiv":"content_7_00","link":""}
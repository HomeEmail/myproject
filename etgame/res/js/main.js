function LoadingRes(e){function n(){var e;if(o>=i)return a(),!1;try{e=new Image}catch(s){return a(),!1}e.onload=function(){e=null,o++,r(parseInt(o/i*100,10)),n(t)},e.onerror=function(){e=null,o++,r(parseInt(o/i*100,10)),n(t)},e.src=t[o]}var t=e.resources||[],i=t.length,o=0,a=e.completed||function(){alert("res loading completed")},r=e.loadingCallback||function(){};this.init=function(){n(t)},this.init()}function fRandomBy(e,n){switch(arguments.length){case 1:return parseInt(Math.random()*e+1);case 2:return parseInt(Math.random()*(n-e+1)+e);default:return 0}}function grid9LayoutTest(){for(var e=posPPAry.length-1;e>=0;e--){var n='<div class="pp-item pp-ufo" style="width:'+sizeBig+"px;height: "+sizeBig+"px;left:"+posPPAry[e][0]+"px;top: "+posPPAry[e][1]+'px;"></div>';gameBox.append(n)}}function scoreTipsCreate(){for(var e=0,n=posPPAry.length;n>e;e++){var t='<span id="scoreTips'+e+'" style="left:'+Math.ceil(posPPAry[e][0]+sizeBig/4)+"px;top: "+Math.ceil(posPPAry[e][1]+sizeBig/4)+'px;" class="scoreTips"></span>';t=$(t),scoreTipsAry.push(t),gameBox.append(t)}}function findScoreTipsById(e){for(var n=-1,t=0,i=posPPHas.length;i>t;t++)if(posPPHas[t]==e)return n=t,scoreTipsAry[t];return!1}function changePosPPToEmpty(e){for(var n=0,t=posPPHas.length;t>n;n++)if(posPPHas[n]==e)return void(posPPHas[n]=0)}function checkPosPPIsOK(){for(var e=[],n=0,t=posPPHas.length;t>n;n++)0==posPPHas[n]&&e.push(n);return e.length>6?e[fRandomBy(0,e.length-1)]:-1}function getGrid9Pos(){var e=checkPosPPIsOK();return-1!=e?{x:posPPAry[e][0],y:posPPAry[e][1],i:e}:!1}function checkPosIsOK(e,n){var t,i=!0;for(t in posRecord)if(posRecord[t][0]<=e&&e<posRecord[t][1]&&posRecord[t][2]<=n&&n<posRecord[t][3]){i=!1;break}return i}function creatPP(){sizeWH=2==fRandomBy(1,2)?sizeBig:sizeSmall;var e=getGrid9Pos();return e?(x=e.x,y=e.y,icon=iconAry[fRandomBy(0,3)],count++,posPPHas[e.i]=count,html='<div data-id="'+count+'" data-name="'+icon+'" data-score="'+scoreIcon[icon]+'" class="pp-item pp-'+icon+'" style="width:'+sizeWH+"px;height: "+sizeWH+"px;left:"+x+"px;top: "+y+'px;opacity:0;"></div>',itemPP[count]=$(html),gameBox.append(itemPP[count]),itemPP[count].fadeIn(180),timePP[count]=setTimeout(function(e){return function(){ppDestroy(e),e=null}}(count),itemTime),void 0):!1}function timeHandler(){timer&&(clearTimeout(timer),timer=null);for(var e=0,n=fRandomBy(1,showPerItemNum);n>e;e++)creatPP();timer=setTimeout(timeHandler,showItemTime)}function ppDestroy(e){itemPP[e]&&itemPP[e].fadeOut(100,function(){$(this).remove(),changePosPPToEmpty(e),itemPP[e]=null,clearTimeout(timePP[e]),timePP[e]=null,delete timePP[e],delete itemPP[e],e=null})}function iconTap(e){var n=$(this),t=n.attr("data-id"),i=n.attr("data-score"),o=n.attr("data-name"),a=findScoreTipsById(t);return scoreTotal+=parseInt(i,10),tapNum[o]+=1,a&&(a.css({opacity:"0.96"}),a.text("+"+i),a.animate({opacity:0,translateY:"-50px"},500,"ease")),ppDestroy(t),sound.pause(),sound.play(),t=null,e.stopPropagation(),!1}function time30Init(){proMaxW=230,proMinW=40,maxTime=3e4,$("#paihangBt").hide()}function time30Cont(){return proMaxW-=2,proMinW>=proMaxW?(clearTimeout(time30),time30=null,void timeoutHandler()):(time30&&(clearTimeout(time30),time30=null),progressBar.css({width:proMaxW+"px"}),void(time30=setTimeout(time30Cont,210)))}function timeoutHandler(){timer&&(clearTimeout(timer),timer=null),$("#gameBox").fadeOut(300),$("#scoreBox").fadeIn(600),$(".score-bt-bg").text("总分："+scoreTotal);var e;for(e in tapNum)$("#"+e+"ScoreCal").text(scoreIcon[e]+"*"+tapNum[e]),$("#"+e+"Score").text(scoreIcon[e]*tapNum[e]);$("#paihangBt").show(),$("title").text("我解救疯狂外星人得了"+scoreTotal+"分！全国排名第"+fRandomBy(20,50)+"位！挑战者每周都有机会获得大奖！"),changeShareData("我解救疯狂外星人得了"+scoreTotal+"分！全国排名第"+fRandomBy(20,50)+"位！挑战者每周都有机会获得大奖！"),uploadScore(scoreTotal)}function uploadScore(e){var n="http://www.gz-3c.com/kz/member/yxJson!insertScore.action?score="+e;$.getJSON(n,function(n){var t=193;"系统异常"!=n.msg&&(t=n.msg),$("title").text("我解救疯狂外星人得了"+e+"分！全国排名第"+t+"位！挑战者每周都有机会获得大奖！"),changeShareData("我解救疯狂外星人得了"+e+"分！全国排名第"+t+"位！挑战者每周都有机会获得大奖！")})}function gameStart(){$("#paihangBt").hide(),$("#playtips").fadeOut(100),$("#gameBox").fadeIn(200,function(){timeHandler(),time30Cont()})}function createPaihangData(){for(var e=[],n=0;10>n;n++)e.push({order:n+1,wxname:" ",score:fRandomBy(1e4*(10-n),2e4/(n+1)*(10-n))});return e}function getPaihangData(){var e="http://www.tailg.com.cn/kz/member/yxJson!findPage.action";$.getJSON(e,function(e){paihangDataRender(e)})}function paihangDataRender(e){for(var n="",e=e,t=e.datas.replace(/'/gi,"").split(","),i=t.length>10?10:t.length,o={},a=0;i>a;a++)o.order=a+1,o.wxname="",o.score=t[a],n+='<div class="paihang-item"><span class="paihang-td">'+o.order+'</span><span class="paihang-td">'+o.wxname+'</span><span class="paihang-td">'+o.score+"</span></div>";$("#paihangContent").html(n)}function gotoGZH(e){var n="gh_928a19d46036";e&&(n=e),location.href=isAndroid()||isWinPhone()?"weixin://profile/"+n:"http://mp.weixin.qq.com/s?__biz=MzA4MDQ5MzkyMA==&mid=204827785&idx=1&sn=b5a108557f82b70a624c9e23f4a06c5c#rd"}function isIphone(){return/(iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent)}function isAndroid(){return/(Android)/i.test(navigator.userAgent)}function isWinPhone(){return/(Windows Phone)/i.test(navigator.userAgent)}var resourceAry=["../res/images/begin.png","../res/images/begin-on.png","../res/images/icon-gou.png","../res/images/icon-xin.png","../res/images/icon-ufo.png","../res/images/icon-ren.png","../res/images/paopao-bg.png","../res/images/again-bt.png","../res/images/share-bt-on.png","../res/images/share-bt.png","../res/images/sharebt1-on.png","../res/images/sharebt1.png","../res/images/time-text.png","../res/images/score-bt-bg.png","../res/images/bg.jpg","../res/images/welcome-bg.png","../res/images/playtips.png"],loadingBox=$("#loadingBox"),welcomeBox=$("#welcome");new LoadingRes({resources:resourceAry,completed:function(){loadingBox.hide(),welcomeBox.show()},loadingCallback:function(e){loadingBox.text("正在为您准备资源..."+e+"%")}});var winW=$(window).width(),winH=$(window).height(),sizeBig=Math.floor(.3333*winW),sizeSmall=Math.ceil(.8*sizeBig),marginTop=Math.ceil((winH-3*sizeBig)/3),posPPAry=[[0*sizeBig,0*sizeBig+marginTop],[1*sizeBig,0*sizeBig+marginTop],[2*sizeBig,0*sizeBig+marginTop],[0*sizeBig,1*sizeBig+marginTop],[1*sizeBig,1*sizeBig+marginTop],[2*sizeBig,1*sizeBig+marginTop],[0*sizeBig,2*sizeBig+marginTop],[1*sizeBig,2*sizeBig+marginTop],[2*sizeBig,2*sizeBig+marginTop]],posPPHas=[0,0,0,0,0,0,0,0,0],scoreTipsAry=[],posRecord={},sizeWH=0,gameBox=$("#gameBox"),scoreTips=$("#scoreTips"),x=0,y=0,xMin=0,xMax=winW,yMin=0,yMax=0,icon="ufo",iconAry=["ufo","ren","xin","gou"],scoreIcon={ufo:150,ren:120,xin:200,gou:60},tapNum={ufo:0,ren:0,xin:0,gou:0},html="",timer=null,timePP={},itemPP={},count=0,itemTime=800,showItemTime=100,showPerItemNum=1,scoreTotal=0,progressBar=$(".progress-on"),sound=new Audio||document.getElementById("sound");sound.src="../res/images/ok.mp3",scoreTipsCreate(),gameBox.on("touchstart MSPointerDown pointerdown",".pp-item",iconTap),document.body.addEventListener("touchstart",function(){}),document.body.addEventListener("touchmove",function(e){e.preventDefault()});var time30=null,proMaxW=230,proMinW=40,maxTime=3e4;$("#welcomeBt").on("tap",function(){$("#welcome").fadeOut(300),$("#playtips").fadeIn(500)}),$("#playtipsBt").on("tap",function(){gameStart()}),$(".again-bt").on("tap",function(){$("#scoreBox").fadeOut(100),scoreTotal=0,tapNum={ufo:0,ren:0,xin:0,gou:0},time30Init(),$("#gameBox").fadeIn(200,function(){timeHandler(),time30Cont()})}),$(".share-bt").on("tap",function(){$("#shareBox").fadeIn(200)}),$("#shareBox").on("tap",function(e){e.stopPropagation(),$(this).fadeOut(200)}),$("#letsgoBt").on("tap",function(){$("#paihangBox").hide(),scoreTotal=0,tapNum={ufo:0,ren:0,xin:0,gou:0},time30Init(),$("#gameBox").fadeIn(200,function(){timeHandler(),time30Cont()})}),$("#paihangShare").on("tap",function(){$("#shareBox").fadeIn(200)});